
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>因子型变量_数据框_函数式编程purrr包 &#8212; My R Learning Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/R语言学习4-语法函数4-因子型变量_数据框_函数式编程purrr包';</script>
    <link rel="canonical" href="https://github.com/crazzy-rabbit/Rscript-to-anaylise-and-visualize/content/R语言学习4-语法函数4-因子型变量_数据框_函数式编程purrr包.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="数据可视化-ggplot入门" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A05-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E5%85%A5%E9%97%A8.html" />
    <link rel="prev" title="语法函数3-正则表达式-stringr包" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A03-%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B03-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-stringr%E5%8C%85.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">My R Learning Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to My R Learning Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A01-%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B01-%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D.html">语法函数1-基础介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A02-%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B02-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86dplyr%E5%8C%85.html">语法函数2-数据处理dplyr包</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A03-%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B03-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-stringr%E5%8C%85.html">语法函数3-正则表达式-stringr包</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">因子型变量_数据框_函数式编程purrr包</a></li>



<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A05-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E5%85%A5%E9%97%A8.html">数据可视化-ggplot入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A06-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%281%29%E4%B9%8B%E5%90%84%E7%A7%8D%E5%9B%BE%E7%9A%84%E5%AE%9E%E7%8E%B0.html"><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>之几何形状</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A07-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%282%29%E4%B9%8B%E6%A0%87%E5%BA%A6scale%E7%9B%B8%E5%85%B3%E8%AF%AD%E6%B3%95.html"><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>之标度<code class="docutils literal notranslate"><span class="pre">scale</span></code>相关语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A08-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%283%29%E4%B9%8B%E4%B8%BB%E9%A2%98%E8%AE%BE%E7%BD%AEtheme%E8%AF%AD%E6%B3%95.html"><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>之主题设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A09-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%284%29%E4%B9%8B%E5%9B%BE%E4%BE%8B%E7%B3%BB%E7%BB%9F.html">ggplot进阶之图例系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A010-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%285%29%E4%B9%8B%E6%89%A9%E5%B1%95%E5%86%85%E5%AE%B9.html"><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>之扩展内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A011-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E8%BF%9B%E9%98%B6%286%29%E4%B9%8B%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%B1%82.html">ggplot2之统计图层</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/crazzy-rabbit/Rscript-to-anaylise-and-visualize" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/crazzy-rabbit/Rscript-to-anaylise-and-visualize/edit/main/docs/rawfile/content/R语言学习4-语法函数4-因子型变量_数据框_函数式编程purrr包.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/crazzy-rabbit/Rscript-to-anaylise-and-visualize/issues/new?title=Issue%20on%20page%20%2Fcontent/R语言学习4-语法函数4-因子型变量_数据框_函数式编程purrr包.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/R语言学习4-语法函数4-因子型变量_数据框_函数式编程purrr包.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>因子型变量_数据框_函数式编程purrr包</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">因子型变量_数据框_函数式编程purrr包</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">什么是因子</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">创建因子</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">调整因子顺序</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">应用</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-reorder"><code class="docutils literal notranslate"> <span class="pre">fct_reorder()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-rev"><code class="docutils literal notranslate"><span class="pre">fct_rev()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-relevel"><code class="docutils literal notranslate"><span class="pre">fct_relevel()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">可视化中应用</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">简单数据框</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tidyverse"><code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> 家族</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tibble">人性化的<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tibble-data-frame">tibble 与 data.frame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><code class="docutils literal notranslate"><span class="pre">tibble</span></code>数据操作</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">1 创建<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2 转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>类型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">3 <code class="docutils literal notranslate"><span class="pre">tibble</span></code>简单操作</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lst">4 有用的函数<code class="docutils literal notranslate"><span class="pre">lst</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enframe">5 有用的函数<code class="docutils literal notranslate"><span class="pre">enframe</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deframe">6 有用的函数<code class="docutils literal notranslate"><span class="pre">deframe</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">7 读取文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">关于行名</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">修复列名</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-columns"><code class="docutils literal notranslate"><span class="pre">List-columns</span></code>(列表列)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nested-tibble"><code class="docutils literal notranslate"><span class="pre">nested</span> <span class="pre">tibble</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating">1 <code class="docutils literal notranslate"><span class="pre">creating</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">1 creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tidyr-summarise-list"><code class="docutils literal notranslate"><span class="pre">tidyr::summarise(list())</span></code>创建</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">1 creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dplyr-mutate"><code class="docutils literal notranslate"><span class="pre">dplyr::mutate()</span></code>创建</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unnesting">2 Unnesting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulating">Manipulating</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">函数式编程1——<code class="docutils literal notranslate"><span class="pre">purrr</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">向量化运算</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">列表</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vs">列表 vs 向量</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19"><code class="docutils literal notranslate"><span class="pre">purrr</span></code>包</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map">1 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">2 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数家族</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">3 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数小结</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">4 额外参数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">5 匿名函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dplyrmap">在<code class="docutils literal notranslate"><span class="pre">dplyr</span></code>函数中的运用<code class="docutils literal notranslate"><span class="pre">map</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">1 在<code class="docutils literal notranslate"><span class="pre">Tibble</span></code>中</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#col-column">2 在<code class="docutils literal notranslate"><span class="pre">col-column</span></code>中</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">函数式编程2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map2"><code class="docutils literal notranslate"><span class="pre">map2()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pmap"><code class="docutils literal notranslate"><span class="pre">pmap()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">1 用在<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">2 匿名函数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">3 命名函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">其他<code class="docutils literal notranslate"><span class="pre">purrr</span></code>函数</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map-functions-that-output-tibbles">1 Map functions that output tibbles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#walk-and-friends">2 Walk and friends</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="purrr">
<h1>因子型变量_数据框_函数式编程purrr包<a class="headerlink" href="#purrr" title="Link to this heading">#</a></h1>
<section id="id1">
<h2>什么是因子<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>因子是把数据进行分类并标记为不同层级(<code class="docutils literal notranslate"><span class="pre">level</span></code>，有时候也翻译成因子水平， 我个人觉得翻译为层级，更接近它的特性，因此，我都会用层级来描述)的数据对象，他们可以存储字符串和整数。因子类型有三个属性：</p>
<ul class="simple">
<li><p>存储类别的数据类型</p></li>
<li><p>离散变量</p></li>
<li><p>因子的层级是有限的，只能取因子层级中的值或缺失(<code class="docutils literal notranslate"><span class="pre">NA</span></code>)</p></li>
</ul>
</section>
<section id="id2">
<h2>创建因子<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>因子层级会自动按照字符串的字母顺序排序，比如<code class="docutils literal notranslate"><span class="pre">high</span> <span class="pre">low</span> <span class="pre">medium</span></code>。也可以用<code class="docutils literal notranslate"><span class="pre">levels=c()</span></code>指定顺序</p></li>
<li><p>不属于因子层级中的值, 会被当作缺省值<code class="docutils literal notranslate"><span class="pre">NA</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Attaching core tidyverse packages</span> ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr    </span> 1.1.4     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr    </span> 2.1.5
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats  </span> 1.0.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr  </span> 1.5.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2  </span> 3.5.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble   </span> 3.2.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">lubridate</span> 1.9.3     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr    </span> 1.3.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr    </span> 1.0.2     
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Conflicts</span> ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
<span class=" -Color -Color-Cyan">ℹ</span> Use the conflicted package (<span class=" -Color -Color-Blue">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">palmerpenguins</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">income</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;high&quot;</span><span class="p">)</span>
<span class="nf">factor</span><span class="p">(</span><span class="n">income</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'high'</li><li>'low'</li><li>'medium'</li></ol>
</details></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## 指定顺序</span>
<span class="nf">factor</span><span class="p">(</span><span class="n">income</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'low'</li><li>'high'</li><li>'medium'</li></ol>
</details></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">factor</span><span class="p">(</span><span class="n">income</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>&lt;NA&gt;</li><li>&lt;NA&gt;</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'low'</li><li>'high'</li></ol>
</details></div></div>
</div>
<p>相比较字符串而言，因子类型更容易处理，因此很多函数会自动的将字符串转换为因子来处理，但事实上，这也会造成，不想当做因子的却又当做了因子的情形</p>
<p>最典型的是在<code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">4.0</span></code>之前，<code class="docutils literal notranslate"><span class="pre">data.frame()</span></code>中<code class="docutils literal notranslate"><span class="pre">stringsAsFactors</span></code>选项，<strong>默认将字符串类型转换为因子类型</strong>，但这个默认也带来一些不方便，因此在R 4.0之后取消了这个默认。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">tidyverse</span></code>集合里，有专门处理因子的宏包<code class="docutils literal notranslate"><span class="pre">forcats</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">forcats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>调整因子顺序<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>因子层级默认是按照字母顺序排序</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_relevel()</span></code>指定因子顺序</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">after=Inf</span></code>将某个因子移到最后面</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_inorder()</span></code> 按照字符串第一次出现的次序</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_reorder()</span></code> 按照其他变量的升序排序 <code class="docutils literal notranslate"><span class="pre">.fun=</span></code>指定函数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_rev()</span></code> 按照因子层级的逆序排序</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_infreq()</span></code>按照因子频率排序，从大到小</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fct_rev(fct_infreq())</span></code>按照因子频率排序，从小到大</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">income</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;high&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">income</span><span class="p">)</span>
<span class="n">x</span>
<span class="c1"># 指定顺序</span>
<span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;high&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;low&quot;</span><span class="p">))</span>
<span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="s">&quot;medium&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="o">=</span><span class="kc">Inf</span><span class="p">)</span>

<span class="c1"># 按照字符串第一次出现的次序</span>
<span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">fct_inorder</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'high'</li><li>'low'</li><li>'medium'</li></ol>
</details></div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'high'</li><li>'medium'</li><li>'low'</li></ol>
</details></div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'medium'</li><li>'high'</li><li>'low'</li></ol>
</details></div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'high'</li><li>'low'</li><li>'medium'</li></ol>
</details></div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'low'</li><li>'high'</li><li>'medium'</li></ol>
</details></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 按照其他变量的中位数的升序排序</span>
<span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>low</li><li>high</li><li>medium</li><li>medium</li><li>low</li><li>high</li><li>high</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'low'</li><li>'medium'</li><li>'high'</li></ol>
</details></div></div>
</div>
</section>
<section id="id4">
<h2>应用<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>调整因子层级有什么用呢？</p>
<p>这个功能在ggplot可视化中调整分类变量的顺序非常方便</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w">  </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="w">  </span>
<span class="p">)</span>
<span class="n">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>a</td><td>2</td></tr>
	<tr><td>a</td><td>2</td></tr>
	<tr><td>b</td><td>1</td></tr>
	<tr><td>b</td><td>5</td></tr>
	<tr><td>c</td><td>0</td></tr>
	<tr><td>c</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cbe39ab5f9de900e61f6fe7a4b68f6bf35a4b81590e68e7756baefa36a4e680f.png" src="../_images/cbe39ab5f9de900e61f6fe7a4b68f6bf35a4b81590e68e7756baefa36a4e680f.png" />
</div>
</div>
<section id="fct-reorder">
<h3><code class="docutils literal notranslate"> <span class="pre">fct_reorder()</span></code><a class="headerlink" href="#fct-reorder" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fct_reorder(x,</span> <span class="pre">y,</span> <span class="pre">.fun=median)</span></code>可以让<code class="docutils literal notranslate"><span class="pre">x</span></code>的顺序按照<code class="docutils literal notranslate"><span class="pre">x</span></code>中每个分类变量对应<code class="docutils literal notranslate"><span class="pre">y</span></code>值的中位数升序排序</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.desc</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>颠倒顺序</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">median</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9cf9c8413236bae0d3e4c2895bced971f356fd6e7fc12c328bc11b038dcebd4e.png" src="../_images/9cf9c8413236bae0d3e4c2895bced971f356fd6e7fc12c328bc11b038dcebd4e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">.desc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
<span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">.desc</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8fb79640d77c3990d52119a48025e26bc4671de77c859b9f71a4a07688d9ee3d.png" src="../_images/8fb79640d77c3990d52119a48025e26bc4671de77c859b9f71a4a07688d9ee3d.png" />
<img alt="../_images/c03f0d6b3afe8969621f9d0a9891c945547b7651768ae698bbe6c2c92487ef94.png" src="../_images/c03f0d6b3afe8969621f9d0a9891c945547b7651768ae698bbe6c2c92487ef94.png" />
</div>
</div>
</section>
<section id="fct-rev">
<h3><code class="docutils literal notranslate"><span class="pre">fct_rev()</span></code><a class="headerlink" href="#fct-rev" title="Link to this heading">#</a></h3>
<p>按照因子层级的逆序排序</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_rev</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d218ebc366d05c3eccdc828e01a318d5f629c176a69f95b989e8c3a2ce1efda7.png" src="../_images/d218ebc366d05c3eccdc828e01a318d5f629c176a69f95b989e8c3a2ce1efda7.png" />
</div>
</div>
</section>
<section id="fct-relevel">
<h3><code class="docutils literal notranslate"><span class="pre">fct_relevel()</span></code><a class="headerlink" href="#fct-relevel" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a19a0e0f97af48e0145e2f9eee60ae279fc1df58b47ac281e4ffc81c617e026d.png" src="../_images/a19a0e0f97af48e0145e2f9eee60ae279fc1df58b47ac281e4ffc81c617e026d.png" />
</div>
</div>
</section>
</section>
<section id="id5">
<h2>可视化中应用<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">palmerpenguins</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">species</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7d2f43225ad91f14c1ad92e93be2550fb8885b6174ed28d75cad322e7a59a732.png" src="../_images/7d2f43225ad91f14c1ad92e93be2550fb8885b6174ed28d75cad322e7a59a732.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 按species逆序</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_rev</span><span class="p">(</span><span class="n">species</span><span class="p">)))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/69856585d81187614652c19a22a6372938208b6d669910725ce39ef3c5ba051a.png" src="../_images/69856585d81187614652c19a22a6372938208b6d669910725ce39ef3c5ba051a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">pull</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

<span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Chinstrap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Gentoo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adelie&quot;</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">pull</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>

<span class="c1"># 把Chinstrap移到前面, 其他顺序不变</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Chinstrap&quot;</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>Adelie</li><li>Chinstrap</li><li>Gentoo</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'Adelie'</li><li>'Chinstrap'</li><li>'Gentoo'</li></ol>
</details></div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>Adelie</li><li>Chinstrap</li><li>Gentoo</li></ol>

<details>
	<summary style=display:list-item;cursor:pointer>
		<strong>Levels</strong>:
	</summary>
	<style>
	.list-inline {list-style: none; margin:0; padding: 0}
	.list-inline>li {display: inline-block}
	.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
	</style>
	<ol class=list-inline><li>'Chinstrap'</li><li>'Gentoo'</li><li>'Adelie'</li></ol>
</details></div><img alt="../_images/93d88367de6a165c8b5389cb71344ccbe8f494cedec6c01556267d7d0f260a3a.png" src="../_images/93d88367de6a165c8b5389cb71344ccbe8f494cedec6c01556267d7d0f260a3a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use order &quot;Chinstrap&quot;, &quot;Gentoo&quot;, &quot;Adelie&quot;</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Chinstrap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Gentoo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adelie&quot;</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0978a42635f978901d0e65c534fbb66d363ecdbe973e251574ee08d1af94e9ef.png" src="../_images/0978a42635f978901d0e65c534fbb66d363ecdbe973e251574ee08d1af94e9ef.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Chinstrap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Gentoo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adelie&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">species</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4cba8e6539ca855109aec2c7ad16009f1b717d8b13fa671da2b9c4dbf1d01c34.png" src="../_images/4cba8e6539ca855109aec2c7ad16009f1b717d8b13fa671da2b9c4dbf1d01c34.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 把Adelie放到最后</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_relevel</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Adelie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="o">=</span><span class="kc">Inf</span><span class="p">)))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ca7a4282b98582dff36f36ad99ffa45be678655fce8095d52a1d0fe7596955d4.png" src="../_images/ca7a4282b98582dff36f36ad99ffa45be678655fce8095d52a1d0fe7596955d4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># fct_infreq() 按照因子频率，从小到大</span>
<span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_infreq</span><span class="p">(</span><span class="n">species</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">species</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>

<span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_rev</span><span class="p">(</span><span class="nf">fct_infreq</span><span class="p">(</span><span class="n">species</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">species</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bdac55243e5d56be39d15494820699568bdda47221103cf3c4a30c9c7385acb8.png" src="../_images/bdac55243e5d56be39d15494820699568bdda47221103cf3c4a30c9c7385acb8.png" />
<img alt="../_images/4cba8e6539ca855109aec2c7ad16009f1b717d8b13fa671da2b9c4dbf1d01c34.png" src="../_images/4cba8e6539ca855109aec2c7ad16009f1b717d8b13fa671da2b9c4dbf1d01c34.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># n是count()函数产生的结果</span>
<span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8afdef0c6f95e0812606f041fc05efdce124fe492d8a9b3a278b1dbb40c7fadd.png" src="../_images/8afdef0c6f95e0812606f041fc05efdce124fe492d8a9b3a278b1dbb40c7fadd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 画出的2007年美洲人口寿命的柱状图，要求从高到低排序</span>

<span class="nf">library</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w"> </span><span class="c1"># install.packages(&quot;gapminder&quot;)</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2007</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Americas&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">()</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_bw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/276973e3149460e66c7c97251ad59b66737fa82eb34ebfaa4bf8eecb9de36673.png" src="../_images/276973e3149460e66c7c97251ad59b66737fa82eb34ebfaa4bf8eecb9de36673.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 四个国家人口寿命的变化图</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Norway&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Portugal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Austria&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f1140a25b19860dbd34ead3ace504aa9213a341ae63cbec43014000f9156e130.png" src="../_images/f1140a25b19860dbd34ead3ace504aa9213a341ae63cbec43014000f9156e130.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 按每个国家寿命的中位数</span>
<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Norway&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Portugal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Austria&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">median</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a891b08c2f25de25c651f5bb1e09ae389d356e43bba3548f2d58a78f72988033.png" src="../_images/a891b08c2f25de25c651f5bb1e09ae389d356e43bba3548f2d58a78f72988033.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 按每个国家寿命差（最大值减去最小值）</span>
<span class="n">cha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
<span class="w">    </span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Norway&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Portugal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spain&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Austria&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="o">=</span><span class="n">cha</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5a5aa172f8146c006cdacbdf78f868cafb4ebf2a6473d4735e785113eed0e456.png" src="../_images/5a5aa172f8146c006cdacbdf78f868cafb4ebf2a6473d4735e785113eed0e456.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id6">
<h1>简单数据框<a class="headerlink" href="#id6" title="Link to this heading">#</a></h1>
<section id="tidyverse">
<h2><code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> 家族<a class="headerlink" href="#tidyverse" title="Link to this heading">#</a></h2>
<p>前面陆续介绍了<code class="docutils literal notranslate"><span class="pre">tidyverse</span></code>家族，家庭主要成员包括</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>功能</p></th>
<th class="head"><p>宏包</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>有颜值担当</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>数据处理王者</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dplyr</span></code></p></td>
</tr>
<tr class="row-even"><td><p>数据转换专家</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tidyr</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>数据载入利器</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">readr</span></code></p></td>
</tr>
<tr class="row-even"><td><p>循环加速器</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">purrr</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>强化数据框</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code></p></td>
</tr>
<tr class="row-even"><td><p>字符串处理</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">stringr</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>因子处理</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">forcats</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="tibble">
<h2>人性化的<code class="docutils literal notranslate"><span class="pre">tibble</span></code><a class="headerlink" href="#tibble" title="Link to this heading">#</a></h2>
<p><img alt="image.png" src="../_images/tibble.png" /></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>是用来替换<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>类型的扩展的数据框</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>继承了<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>，是弱类型的。换句话说，<code class="docutils literal notranslate"><span class="pre">tibble</span></code>是<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>的子类型</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>与<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>有相同的语法，使用起来更方便</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>更早的检查数据，方便写出更干净、更多富有表现力的代码</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>对<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>做了重新的设定：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，不关心输入类型，可存储任意类型，包括<code class="docutils literal notranslate"><span class="pre">list</span></code>类型</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，没有行名设置 <code class="docutils literal notranslate"><span class="pre">row.names</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，支持任意的列名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，会自动添加列名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，类型只能回收长度为1的输入</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，会懒加载参数，并按顺序运行</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>，是<code class="docutils literal notranslate"><span class="pre">tbl_df</span></code>类型</p></li>
</ul>
</section>
<section id="tibble-data-frame">
<h2>tibble 与 data.frame<a class="headerlink" href="#tibble-data-frame" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 传统创建数据框</span>
<span class="nf">data.frame</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 5 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>a</td></tr>
	<tr><td>2</td><td>b</td></tr>
	<tr><td>3</td><td>c</td></tr>
	<tr><td>4</td><td>d</td></tr>
	<tr><td>5</td><td>e</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>发现，<code class="docutils literal notranslate"><span class="pre">data.frame()</span></code>会自动将<strong>字符串型</strong>的变量转换成<strong>因子型</strong>，如果想保持原来的字符串型，就得</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">],</span>
<span class="w">  </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 5 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>a</td></tr>
	<tr><td>2</td><td>b</td></tr>
	<tr><td>3</td><td>c</td></tr>
	<tr><td>4</td><td>d</td></tr>
	<tr><td>5</td><td>e</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Note： - 在<code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">4.0</span></code> 后，<code class="docutils literal notranslate"><span class="pre">data.frame()</span></code> 不会将字符串型变量自动转换成因子型</p>
<p>用<code class="docutils literal notranslate"><span class="pre">tibble</span></code>创建数据框，不会这么麻烦，输出的就是原来的字符串类型</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>a</td></tr>
	<tr><td>2</td><td>b</td></tr>
	<tr><td>3</td><td>c</td></tr>
	<tr><td>4</td><td>d</td></tr>
	<tr><td>5</td><td>e</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>构建两个有关联的变量，传统的<code class="docutils literal notranslate"><span class="pre">data.frame()</span></code>会报错</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">+2</span><span class="p">)</span>
<span class="n">tb</span>

<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">+2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>3</td></tr>
	<tr><td>2</td><td>4</td></tr>
	<tr><td>3</td><td>5</td></tr>
</tbody>
</table>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message in Ops.factor(x, 2):
“‘+’ not meaningful for factors”
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span> <span class="n">参数值意味着不同的行数</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">stop</span><span class="p">(</span><span class="n">gettextf</span><span class="p">(</span><span class="s2">&quot;arguments imply differing number of rows: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">paste</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">nrows</span><span class="p">),</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="p">)),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>用缩写定义了7种类型：</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>类型</p></th>
<th class="head"><p>含义</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p>代表<code class="docutils literal notranslate"><span class="pre">integer</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dbl</span></code></p></td>
<td><p>代表<code class="docutils literal notranslate"><span class="pre">double</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">chr</span></code></p></td>
<td><p>代表<code class="docutils literal notranslate"><span class="pre">character</span></code>向量或字符串</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dttm</span></code></p></td>
<td><p>代表日期+时间(<code class="docutils literal notranslate"><span class="pre">date</span></code>+<code class="docutils literal notranslate"><span class="pre">time</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">lgl</span></code></p></td>
<td><p>代表逻辑判断<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>或者<code class="docutils literal notranslate"><span class="pre">FALSE</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fctr</span></code></p></td>
<td><p>代表因子类型<code class="docutils literal notranslate"><span class="pre">factor</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p>代表日期<code class="docutils literal notranslate"><span class="pre">dates</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id7">
<h2><code class="docutils literal notranslate"><span class="pre">tibble</span></code>数据操作<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<section id="id8">
<h3>1 创建<code class="docutils literal notranslate"><span class="pre">tibble</span></code><a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tibble()</span></code> 创建方式和<code class="docutils literal notranslate"><span class="pre">data.frame()</span></code>一样</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble::tribble()</span></code>更加直观</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># tibble()创建一个tibble类型的data.frame:</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span>
<span class="w">      </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">14</span><span class="p">,</span>
<span class="w">      </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>a</td></tr>
	<tr><td>2</td><td>b</td></tr>
	<tr><td>3</td><td>c</td></tr>
	<tr><td>4</td><td>d</td></tr>
	<tr><td>5</td><td>e</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 3</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th><th scope=col>c</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>10</td><td>11</td></tr>
	<tr><td>2</td><td>11</td><td>13</td></tr>
	<tr><td>3</td><td>12</td><td>15</td></tr>
	<tr><td>4</td><td>13</td><td>17</td></tr>
	<tr><td>5</td><td>14</td><td>19</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 为了让每列更加直观，也可以tribble()创建，数据量不大的时候</span>
<span class="n">tibble</span><span class="o">::</span><span class="nf">tribble</span><span class="p">(</span>
<span class="w">  </span><span class="o">~</span><span class="n">x</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">z</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3.6</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">8.5</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 3</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th><th scope=col>z</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>a</td><td>2</td><td>3.6</td></tr>
	<tr><td>b</td><td>1</td><td>8.5</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id9">
<h3>2 转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>类型<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>类型意思就是说，刚开始不是<code class="docutils literal notranslate"><span class="pre">tibble</span></code>, 现在转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>， 包括</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data.frame</span></code>转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">as_tibble()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runif(n,</span> <span class="pre">min=0,</span> <span class="pre">max=1)</span></code>生成n个0-1之间的均匀分布随机数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.frame()</span></code>转回去</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vector</span></code>转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list</span></code>转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">as.list()</span></code>转回去</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">matrix</span></code>转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>转回<code class="docutils literal notranslate"><span class="pre">matrix</span></code>? <code class="docutils literal notranslate"><span class="pre">as.matrix()</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># data.frame转换成tibble</span>
<span class="n">t1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span>
<span class="nf">class</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

<span class="nf">as_tibble</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'data.frame'</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 4</caption>
<thead>
	<tr><th scope=col>Sepal.Length</th><th scope=col>Sepal.Width</th><th scope=col>Petal.Length</th><th scope=col>Petal.Width</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td></tr>
	<tr><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td></tr>
	<tr><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td></tr>
	<tr><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td></tr>
	<tr><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td></tr>
	<tr><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># vector转型到tibble</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 1</caption>
<thead>
	<tr><th scope=col>value</th></tr>
	<tr><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td></tr>
	<tr><td>2</td></tr>
	<tr><td>3</td></tr>
	<tr><td>4</td></tr>
	<tr><td>5</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 把list转型为tibble</span>
<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as_tibble</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">1</span><span class="p">))</span>
<span class="n">df</span>
<span class="c1"># 把tibble再转为list? as.list(df)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 3</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th><th scope=col>z</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>0.51710681</td><td>6</td></tr>
	<tr><td>2</td><td>0.46294658</td><td>5</td></tr>
	<tr><td>3</td><td>0.05082761</td><td>4</td></tr>
	<tr><td>4</td><td>0.55497789</td><td>3</td></tr>
	<tr><td>5</td><td>0.10972415</td><td>2</td></tr>
	<tr><td>6</td><td>0.10519147</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#  把matrix转型为tibble</span>
<span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="n">m</span>
<span class="nf">as_tibble</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1"># tibble转回matrix? as.matrix(df)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 3 × 5 of type dbl</caption>
<tbody>
	<tr><td> 1.2502136</td><td> 1.6178274</td><td> 0.5113479</td><td> 0.06344089</td><td>0.90235800</td></tr>
	<tr><td> 1.1180396</td><td>-0.5176620</td><td> 0.5803835</td><td>-0.60596035</td><td>2.09074303</td></tr>
	<tr><td>-0.7704595</td><td>-0.6992101</td><td>-0.3455487</td><td> 1.05734880</td><td>0.09283674</td></tr>
</tbody>
</table>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
<span class=" -Color -Color-Cyan">ℹ</span> Using compatibility `.name_repair`.”
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 5</caption>
<thead>
	<tr><th scope=col>V1</th><th scope=col>V2</th><th scope=col>V3</th><th scope=col>V4</th><th scope=col>V5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> 1.2502136</td><td> 1.6178274</td><td> 0.5113479</td><td> 0.06344089</td><td>0.90235800</td></tr>
	<tr><td> 1.1180396</td><td>-0.5176620</td><td> 0.5803835</td><td>-0.60596035</td><td>2.09074303</td></tr>
	<tr><td>-0.7704595</td><td>-0.6992101</td><td>-0.3455487</td><td> 1.05734880</td><td>0.09283674</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id10">
<h3>3 <code class="docutils literal notranslate"><span class="pre">tibble</span></code>简单操作<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>增加一列</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">add_column()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mutate()</span></code></p></li>
</ul>
</li>
<li><p>增加一行</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">add_row()</span></code> 默认加在最后</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.before=n</span></code>指定加在哪一行</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 构建一个简单的数据框</span>
<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">1</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
	<tr><td>2</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 增加一列</span>
<span class="nf">add_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>

<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span>
<span class="w">         </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 4</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th><th scope=col>z</th><th scope=col>w</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td><td>0</td><td>0</td></tr>
	<tr><td>2</td><td>1</td><td>1</td><td>0</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 4</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th><th scope=col>z</th><th scope=col>w</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td><td>0</td><td>0</td></tr>
	<tr><td>2</td><td>1</td><td>1</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 增加一行</span>
<span class="nf">add_row</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span>

<span class="c1"># 在第二行，增加一行</span>
<span class="nf">add_row</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">.before</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> 1</td><td>2</td></tr>
	<tr><td> 2</td><td>1</td></tr>
	<tr><td>99</td><td>9</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> 1</td><td>2</td></tr>
	<tr><td>99</td><td>9</td></tr>
	<tr><td> 2</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="lst">
<h3>4 有用的函数<code class="docutils literal notranslate"><span class="pre">lst</span></code><a class="headerlink" href="#lst" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lst</span></code>，创建一个<code class="docutils literal notranslate"><span class="pre">list</span></code>，具有<code class="docutils literal notranslate"><span class="pre">tibble</span></code>特性的<code class="docutils literal notranslate"><span class="pre">list</span></code>。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tibble</span><span class="o">::</span><span class="nf">lst</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$n</dt>
		<dd>5</dd>
	<dt>$x</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>0.793093437328935</li><li>0.938775967340916</li><li>0.627412877511233</li><li>0.317401449894533</li><li>0.664086581440642</li></ol>
</dd>
	<dt>$y</dt>
		<dd>TRUE</dd>
</dl>
</div></div>
</div>
</section>
<section id="enframe">
<h3>5 有用的函数<code class="docutils literal notranslate"><span class="pre">enframe</span></code><a class="headerlink" href="#enframe" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enframe()</span></code>将矢量快速创建<code class="docutils literal notranslate"><span class="pre">tibble</span></code>，创建的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>只有2列: <code class="docutils literal notranslate"><span class="pre">name</span></code>和<code class="docutils literal notranslate"><span class="pre">value</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">enframe</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>name</th><th scope=col>value</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>1</td></tr>
	<tr><td>2</td><td>2</td></tr>
	<tr><td>3</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">enframe</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>name</th><th scope=col>value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>a</td><td>5</td></tr>
	<tr><td>b</td><td>7</td></tr>
	<tr><td>c</td><td>9</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="deframe">
<h3>6 有用的函数<code class="docutils literal notranslate"><span class="pre">deframe</span></code><a class="headerlink" href="#deframe" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">deframe()</span></code>可以看做是<code class="docutils literal notranslate"><span class="pre">enframe()</span></code>的反操作，把<code class="docutils literal notranslate"><span class="pre">tibble</span></code>反向转成向量</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">enframe</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">))</span>
<span class="n">df</span>

<span class="nf">deframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 2 × 2</caption>
<thead>
	<tr><th scope=col>name</th><th scope=col>value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>a</td><td>5</td></tr>
	<tr><td>b</td><td>7</td></tr>
</tbody>
</table>
</div><div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>a</dt><dd>5</dd><dt>b</dt><dd>7</dd></dl>
</div></div>
</div>
</section>
<section id="id11">
<h3>7 读取文件<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read_csv()</span></code>读取文件时，生成的直接就是<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;./test.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">Error</span>: &#39;./test.csv&#39; does not exist in current working directory (&#39;/public/home/sll/mybook/content&#39;).
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./test.csv&quot;</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">vroom</span><span class="p">::</span><span class="n">vroom</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delim</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">col_names</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">col_select</span> <span class="o">=</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="p">{</span>
 <span class="o">.</span>             <span class="n">col_select</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>     <span class="p">},</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="n">name_repair</span><span class="p">,</span> <span class="n">skip</span> <span class="o">=</span> <span class="n">skip</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="n">n_max</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">na</span> <span class="o">=</span> <span class="n">na</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">quote</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">skip_empty_rows</span> <span class="o">=</span> <span class="n">skip_empty_rows</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">trim_ws</span> <span class="o">=</span> <span class="n">trim_ws</span><span class="p">,</span> <span class="n">escape_double</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">escape_backslash</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="p">,</span> <span class="n">guess_max</span> <span class="o">=</span> <span class="n">guess_max</span><span class="p">,</span> <span class="n">show_col_types</span> <span class="o">=</span> <span class="n">show_col_types</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span><span class="p">,</span> <span class="n">altrep</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">,</span> <span class="n">num_threads</span> <span class="o">=</span> <span class="n">num_threads</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">vroom_</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delim</span> <span class="o">=</span> <span class="n">delim</span> <span class="o">%||%</span> <span class="n">col_types</span><span class="err">$</span><span class="n">delim</span><span class="p">,</span> <span class="n">col_names</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span> <span class="n">skip</span> <span class="o">=</span> <span class="n">skip</span><span class="p">,</span> <span class="n">col_select</span> <span class="o">=</span> <span class="n">col_select</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">na</span> <span class="o">=</span> <span class="n">na</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="n">quote</span><span class="p">,</span> <span class="n">trim_ws</span> <span class="o">=</span> <span class="n">trim_ws</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">escape_double</span> <span class="o">=</span> <span class="n">escape_double</span><span class="p">,</span> <span class="n">escape_backslash</span> <span class="o">=</span> <span class="n">escape_backslash</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">skip_empty_rows</span> <span class="o">=</span> <span class="n">skip_empty_rows</span><span class="p">,</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">guess_max</span> <span class="o">=</span> <span class="n">guess_max</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="n">n_max</span><span class="p">,</span> <span class="n">altrep</span> <span class="o">=</span> <span class="n">vroom_altrep</span><span class="p">(</span><span class="n">altrep</span><span class="p">),</span> 
 <span class="o">.</span>     <span class="n">num_threads</span> <span class="o">=</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span><span class="p">)</span>
<span class="mi">4</span><span class="o">.</span> <span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span> 
 <span class="o">.</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">return</span><span class="p">(</span><span class="n">rawConnection</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.character<span class="o">(</span>path<span class="o">))</span><span class="w"> </span><span class="o">{</span>
 <span class="o">.</span>         <span class="k">return</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">is_url</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="n">requireNamespace</span><span class="p">(</span><span class="s2">&quot;curl&quot;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">con</span> <span class="o">&lt;-</span> <span class="n">curl</span><span class="p">::</span><span class="n">curl</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>         <span class="k">else</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">inform</span><span class="p">(</span><span class="s2">&quot;`curl` package not installed, falling back to using `url()`&quot;</span><span class="p">)</span>
 <span class="o">.</span>             <span class="n">con</span> <span class="o">&lt;-</span> <span class="n">url</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>         <span class="n">ext</span> <span class="o">&lt;-</span> <span class="n">tolower</span><span class="p">(</span><span class="n">tools</span><span class="p">::</span><span class="n">file_ext</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
 <span class="o">.</span>         <span class="k">return</span><span class="p">(</span><span class="n">switch</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="nb">zip</span> <span class="o">=</span> <span class="p">,</span> <span class="n">bz2</span> <span class="o">=</span> <span class="p">,</span> <span class="n">xz</span> <span class="o">=</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">close</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
 <span class="o">.</span>             <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Reading from remote `&quot;</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="s2">&quot;` compressed files is not supported,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                 <span class="s2">&quot;  download the files locally first.&quot;</span><span class="p">,</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
 <span class="o">.</span>         <span class="p">},</span> <span class="n">gz</span> <span class="o">=</span> <span class="n">gzcon</span><span class="p">(</span><span class="n">con</span><span class="p">),</span> <span class="n">con</span><span class="p">))</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="n">path</span> <span class="o">&lt;-</span> <span class="n">enc2utf8</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">p</span> <span class="o">&lt;-</span> <span class="n">split_path_ext</span><span class="p">(</span><span class="n">basename_utf8</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">write</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">path</span> <span class="o">&lt;-</span> <span class="n">normalizePath_utf8</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mustWork</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">path</span> <span class="o">&lt;-</span> <span class="n">check_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">is_installed</span><span class="p">(</span><span class="s2">&quot;archive&quot;</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">formats</span> <span class="o">&lt;-</span> <span class="n">archive_formats</span><span class="p">(</span><span class="n">p</span><span class="err">$</span><span class="n">extension</span><span class="p">)</span>
 <span class="o">.</span>         <span class="n">extension</span> <span class="o">&lt;-</span> <span class="n">p</span><span class="err">$</span><span class="n">extension</span>
 <span class="o">.</span>         <span class="k">while</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">nzchar</span><span class="p">(</span><span class="n">extension</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">extension</span> <span class="o">&lt;-</span> <span class="n">split_path_ext</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span><span class="err">$</span><span class="n">extension</span>
 <span class="o">.</span>             <span class="n">formats</span> <span class="o">&lt;-</span> <span class="n">archive_formats</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="o">(</span>formats<span class="o">))</span><span class="w"> </span><span class="o">{</span>
 <span class="o">.</span>             <span class="n">p</span><span class="err">$</span><span class="n">extension</span> <span class="o">&lt;-</span> <span class="n">extension</span>
 <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="n">write</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">formats</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]))</span> <span class="p">{</span>
 <span class="o">.</span>                   <span class="k">return</span><span class="p">(</span><span class="n">archive</span><span class="p">::</span><span class="n">file_write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">filter</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">2</span><span class="p">]]))</span>
 <span class="o">.</span>                 <span class="p">}</span>
 <span class="o">.</span>                 <span class="k">return</span><span class="p">(</span><span class="n">archive</span><span class="p">::</span><span class="n">archive_write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="err">$</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">1</span><span class="p">]],</span> 
 <span class="o">.</span>                   <span class="nb">filter</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">2</span><span class="p">]]))</span>
 <span class="o">.</span>             <span class="p">}</span>
 <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">formats</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]))</span> <span class="p">{</span>
 <span class="o">.</span>                 <span class="k">return</span><span class="p">(</span><span class="n">archive</span><span class="p">::</span><span class="n">file_read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">filter</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">2</span><span class="p">]]))</span>
 <span class="o">.</span>             <span class="p">}</span>
 <span class="o">.</span>             <span class="k">return</span><span class="p">(</span><span class="n">archive</span><span class="p">::</span><span class="n">archive_read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">1</span><span class="p">]],</span> 
 <span class="o">.</span>                 <span class="nb">filter</span> <span class="o">=</span> <span class="n">formats</span><span class="p">[[</span><span class="mi">2</span><span class="p">]]))</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>write<span class="o">)</span><span class="w"> </span><span class="o">{</span>
 <span class="o">.</span>         <span class="n">compression</span> <span class="o">&lt;-</span> <span class="n">detect_compression</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">compression</span> <span class="o">&lt;-</span> <span class="n">NA</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">na</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">compression</span> <span class="o">&lt;-</span> <span class="n">tools</span><span class="p">::</span><span class="n">file_ext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">write</span> <span class="o">&amp;&amp;</span> <span class="n">compression</span> <span class="o">==</span> <span class="s2">&quot;zip&quot;</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;Can only read from, not write to, .zip&quot;</span><span class="p">,</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="n">switch</span><span class="p">(</span><span class="n">compression</span><span class="p">,</span> <span class="n">gz</span> <span class="o">=</span> <span class="n">gzfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">bz2</span> <span class="o">=</span> <span class="n">bzfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> 
 <span class="o">.</span>         <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">xz</span> <span class="o">=</span> <span class="n">xzfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nb">zip</span> <span class="o">=</span> <span class="n">zipfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span>has_trailing_newline<span class="o">(</span>path<span class="o">))</span><span class="w"> </span><span class="o">{</span>
 <span class="o">.</span>             <span class="n">file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
 <span class="o">.</span>         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">path</span>
 <span class="o">.</span>         <span class="p">})</span>
 <span class="o">.</span> <span class="p">})(</span><span class="s2">&quot;./test.csv&quot;</span><span class="p">)</span>
<span class="mi">5</span><span class="o">.</span> <span class="n">check_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="mi">6</span><span class="o">.</span> <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;&#39; does not exist&quot;</span><span class="p">,</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is_absolute_path<span class="o">(</span>path<span class="o">))</span><span class="w"> </span><span class="o">{</span>
<span class="nn"> .     paste0(&quot;</span> in <span class="ni">current working directory (&#39;&quot;, getwd</span><span class="nt">(), &quot;&#39;)&quot;)</span>
 <span class="o">.</span> <span class="p">},</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id12">
<h2>关于行名<a class="headerlink" href="#id12" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">data.frame</span></code>是支持行名的，但<code class="docutils literal notranslate"><span class="pre">tibble</span></code>不支持行名，这也是两者不同的地方</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">has_rownames(df)</span></code> 判断是否有行名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rownames_to_column(df,</span> <span class="pre">var=&quot;rowname&quot;)</span></code>把df的行名转换为单独的一列<code class="docutils literal notranslate"><span class="pre">rowname</span></code>，没行索引了就</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowid_to_column(df,</span> <span class="pre">var=&quot;rowid&quot;)</span></code>把df的把行索引转换为单独的一列,多一列<code class="docutils literal notranslate"><span class="pre">rowid</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># dataframe 支持行名</span>
<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">1</span><span class="p">)</span>

<span class="nf">row.names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
<span class="n">df</span>

<span class="nf">print</span><span class="p">(</span><span class="s">&quot;判断是否有行名&quot;</span><span class="p">)</span>
<span class="nf">has_rownames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># tibble 不支持行名</span>
<span class="n">tb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">1</span><span class="p">)</span>

<span class="nf">row.names</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 2</caption>
<thead>
	<tr><th></th><th scope=col>x</th><th scope=col>y</th></tr>
	<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>A</th><td>1</td><td>3</td></tr>
	<tr><th scope=row>B</th><td>2</td><td>2</td></tr>
	<tr><th scope=row>C</th><td>3</td><td>1</td></tr>
</tbody>
</table>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;判断是否有行名&quot;
</pre></div>
</div>
<div class="output text_html">TRUE</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Setting row names on a tibble is deprecated.”
</pre></div>
</div>
</div>
</div>
<p>需要注意的：</p>
<ul class="simple">
<li><p>有时候遇到含有行名的<code class="docutils literal notranslate"><span class="pre">data.frame</span></code>，转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>后，<strong>行名会被丢弃</strong></p></li>
<li><p>如果想保留行名，就需要把行名转换成单独的一列</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
<span class="n">df</span>

<span class="c1"># 把行名转换为单独的一列</span>
<span class="nf">rownames_to_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;myrow&quot;</span><span class="p">)</span>

<span class="c1"># 这俩是添加一列，但行名还在</span>
<span class="n">df</span><span class="o">$</span><span class="n">rowname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rownames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>

<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">rowname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rownames</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
	<tr><th></th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>Mazda RX4</th><td>21.0</td><td>6</td><td>160</td></tr>
	<tr><th scope=row>Mazda RX4 Wag</th><td>21.0</td><td>6</td><td>160</td></tr>
	<tr><th scope=row>Datsun 710</th><td>22.8</td><td>4</td><td>108</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 4</caption>
<thead>
	<tr><th scope=col>myrow</th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Mazda RX4    </td><td>21.0</td><td>6</td><td>160</td></tr>
	<tr><td>Mazda RX4 Wag</td><td>21.0</td><td>6</td><td>160</td></tr>
	<tr><td>Datsun 710   </td><td>22.8</td><td>4</td><td>108</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 4</caption>
<thead>
	<tr><th></th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>rowname</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>Mazda RX4</th><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4    </td></tr>
	<tr><th scope=row>Mazda RX4 Wag</th><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4 Wag</td></tr>
	<tr><th scope=row>Datsun 710</th><td>22.8</td><td>4</td><td>108</td><td>Datsun 710   </td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 4</caption>
<thead>
	<tr><th></th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>rowname</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>Mazda RX4</th><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4    </td></tr>
	<tr><th scope=row>Mazda RX4 Wag</th><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4 Wag</td></tr>
	<tr><th scope=row>Datsun 710</th><td>22.8</td><td>4</td><td>108</td><td>Datsun 710   </td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 把行索引转换为单独的一列</span>
<span class="nf">rowid_to_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">var</span><span class="o">=</span><span class="s">&quot;rowid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 5</caption>
<thead>
	<tr><th scope=col>rowid</th><th scope=col>mpg</th><th scope=col>cyl</th><th scope=col>disp</th><th scope=col>rowname</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4    </td></tr>
	<tr><td>2</td><td>21.0</td><td>6</td><td>160</td><td>Mazda RX4 Wag</td></tr>
	<tr><td>3</td><td>22.8</td><td>4</td><td>108</td><td>Datsun 710   </td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id13">
<h2>修复列名<a class="headerlink" href="#id13" title="Link to this heading">#</a></h2>
<p>规范的来说，数据框的列名应该是唯一。但现实中代码是人写的，因此可能会稀奇古怪的，所幸的是<code class="docutils literal notranslate"><span class="pre">tibble</span></code>也提供了人性化的解决方案</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.name_repair</span> <span class="pre">=</span> <span class="pre">&quot;check_unique&quot;</span></code> 检查列名唯一性，但不做修复（默认）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.name_repair</span> <span class="pre">=</span> <span class="pre">&quot;minimal&quot;</span></code>， 不检查也不修复，维持现状</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.name_repair</span> <span class="pre">=</span> <span class="pre">&quot;unique&quot;</span></code> 修复列名，使得列名唯一且不为空</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.name_repair</span> <span class="pre">=</span> <span class="pre">&quot;universal&quot;</span></code> 修复列名，使得列名唯一且语法可读</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make.unique(.x,</span> <span class="pre">sep=&quot;_&quot;)</span></code>指定修复函数</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="err">`</span><span class="n">tibble</span><span class="p">()</span><span class="err">`</span><span class="p">:</span>
<span class="o">!</span><span class="w"> </span>Column<span class="w"> </span>name<span class="w"> </span><span class="sb">`</span>x<span class="sb">`</span><span class="w"> </span>must<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>duplicated.
<span class="n">Use</span> <span class="err">`</span><span class="o">.</span><span class="n">name_repair</span><span class="err">`</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">repair</span><span class="o">.</span>
<span class="n">Caused</span> <span class="n">by</span> <span class="n">error</span> <span class="ow">in</span> <span class="err">`</span><span class="n">repaired_names</span><span class="p">()</span><span class="err">`</span><span class="p">:</span>
<span class="o">!</span><span class="w"> </span>Names<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>unique.
<span class="err">✖</span> <span class="n">These</span> <span class="n">names</span> <span class="n">are</span> <span class="n">duplicated</span><span class="p">:</span>
  <span class="o">*</span> <span class="s2">&quot;x&quot;</span> <span class="n">at</span> <span class="n">locations</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mf">2.</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">tibble_quos</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">set_repaired_names</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">4</span><span class="o">.</span> <span class="n">repaired_names</span><span class="p">(</span><span class="n">names2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">5</span><span class="o">.</span> <span class="n">subclass_name_repair_errors</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">vec_as_names</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span> <span class="o">||</span> 
 <span class="o">.</span>         <span class="o">!</span>is_character<span class="o">(</span>.name_repair<span class="o">))</span>,<span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>call<span class="o">)</span>
<span class="mi">6</span><span class="o">.</span> <span class="n">withCallingHandlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">vctrs_error_names_cannot_be_empty</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="n">abort_column_names_cannot_be_empty</span><span class="p">(</span><span class="n">detect_empty_names</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
 <span class="o">.</span>         <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> 
 <span class="o">.</span>         <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
 <span class="o">.</span> <span class="p">},</span> <span class="n">vctrs_error_names_cannot_be_dot_dot</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="n">abort_column_names_cannot_be_dot_dot</span><span class="p">(</span><span class="n">detect_dot_dot</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
 <span class="o">.</span>         <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
 <span class="o">.</span> <span class="p">},</span> <span class="n">vctrs_error_names_must_be_unique</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="n">abort_column_names_must_be_unique</span><span class="p">(</span><span class="n">detect_duplicates</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
 <span class="o">.</span>         <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
 <span class="o">.</span> <span class="p">})</span>
<span class="mi">7</span><span class="o">.</span> <span class="n">vec_as_names</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span> <span class="o">||</span> <span class="o">!</span>is_character<span class="o">(</span>.name_repair<span class="o">))</span>
<span class="mi">8</span><span class="o">.</span> <span class="p">(</span><span class="n">function</span> <span class="p">()</span> 
 <span class="o">.</span> <span class="n">validate_unique</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">))()</span>
<span class="mi">9</span><span class="o">.</span> <span class="n">validate_unique</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">10</span><span class="o">.</span> <span class="n">stop_names_must_be_unique</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">11</span><span class="o">.</span> <span class="n">stop_names</span><span class="p">(</span><span class="k">class</span> <span class="err">= &quot;</span><span class="nc">vctrs_error_names_must_be_unique</span><span class="s2">&quot;, arg = arg, </span>
  <span class="o">.</span>     <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">12</span><span class="o">.</span> <span class="n">stop_vctrs</span><span class="p">(</span><span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="s2">&quot;vctrs_error_names&quot;</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">13</span><span class="o">.</span> <span class="n">abort</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="s2">&quot;vctrs_error&quot;</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">14</span><span class="o">.</span> <span class="n">signal_abort</span><span class="p">(</span><span class="n">cnd</span><span class="p">,</span> <span class="o">.</span><span class="n">file</span><span class="p">)</span>
<span class="mi">15</span><span class="o">.</span> <span class="n">signalCondition</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span>
<span class="mi">16</span><span class="o">.</span> <span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">cnd</span><span class="p">)</span> 
  <span class="o">.</span> <span class="p">{</span>
  <span class="o">.</span>     <span class="n">abort_column_names_must_be_unique</span><span class="p">(</span><span class="n">detect_duplicates</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
  <span class="o">.</span>         <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
  <span class="o">.</span> <span class="p">})(</span><span class="n">structure</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">structure</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">call</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
  <span class="o">.</span>     <span class="n">IRkernel</span><span class="p">::</span><span class="n">main</span><span class="p">(),</span> <span class="n">kernel</span><span class="err">$</span><span class="n">run</span><span class="p">(),</span> <span class="n">handle_shell</span><span class="p">(),</span> <span class="n">executor</span><span class="err">$</span><span class="n">execute</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="n">tryCatch</span><span class="p">(</span><span class="n">evaluate</span><span class="p">(</span><span class="n">request</span><span class="err">$</span><span class="n">content</span><span class="err">$</span><span class="n">code</span><span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="o">.</span><span class="n">GlobalEnv</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">output_handler</span> <span class="o">=</span> <span class="n">oh</span><span class="p">,</span> <span class="n">stop_on_error</span> <span class="o">=</span> <span class="mi">1</span><span class="n">L</span><span class="p">),</span> <span class="n">interrupt</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">.</span>         <span class="n">log_debug</span><span class="p">(</span><span class="s2">&quot;Interrupt during execution&quot;</span><span class="p">)</span>
  <span class="o">.</span>         <span class="n">interrupted</span> <span class="o">&lt;&lt;-</span> <span class="n">TRUE</span>
  <span class="o">.</span>     <span class="p">},</span> <span class="n">error</span> <span class="o">=</span> <span class="o">.</span><span class="n">self</span><span class="err">$</span><span class="n">handle_error</span><span class="p">),</span> <span class="n">tryCatchList</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">),</span> <span class="n">tryCatchOne</span><span class="p">(</span><span class="n">tryCatchList</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="n">nh</span><span class="p">],</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">[</span><span class="o">-</span><span class="n">nh</span><span class="p">]),</span> <span class="n">names</span><span class="p">[</span><span class="n">nh</span><span class="p">],</span> <span class="n">parentenv</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">handlers</span><span class="p">[[</span><span class="n">nh</span><span class="p">]]),</span> <span class="n">doTryCatch</span><span class="p">(</span><span class="k">return</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">handler</span><span class="p">),</span> <span class="n">tryCatchList</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="n">nh</span><span class="p">],</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">[</span><span class="o">-</span><span class="n">nh</span><span class="p">]),</span> 
  <span class="o">.</span>     <span class="n">tryCatchOne</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">[[</span><span class="mi">1</span><span class="n">L</span><span class="p">]]),</span> <span class="n">doTryCatch</span><span class="p">(</span><span class="k">return</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> 
  <span class="o">.</span>         <span class="n">name</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handler</span><span class="p">),</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">request</span><span class="err">$</span><span class="n">content</span><span class="err">$</span><span class="n">code</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span> <span class="o">=</span> <span class="o">.</span><span class="n">GlobalEnv</span><span class="p">,</span> <span class="n">output_handler</span> <span class="o">=</span> <span class="n">oh</span><span class="p">,</span> <span class="n">stop_on_error</span> <span class="o">=</span> <span class="mi">1</span><span class="n">L</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="n">evaluate_call</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">parsed</span><span class="err">$</span><span class="n">src</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span> <span class="o">=</span> <span class="n">enclos</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="n">length</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">use_try</span> <span class="o">=</span> <span class="n">stop_on_error</span> <span class="o">!=</span> 
  <span class="o">.</span>             <span class="mi">2</span><span class="n">L</span><span class="p">,</span> <span class="n">keep_warning</span> <span class="o">=</span> <span class="n">keep_warning</span><span class="p">,</span> <span class="n">keep_message</span> <span class="o">=</span> <span class="n">keep_message</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">log_echo</span> <span class="o">=</span> <span class="n">log_echo</span><span class="p">,</span> <span class="n">log_warning</span> <span class="o">=</span> <span class="n">log_warning</span><span class="p">,</span> <span class="n">output_handler</span> <span class="o">=</span> <span class="n">output_handler</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">include_timing</span> <span class="o">=</span> <span class="n">include_timing</span><span class="p">),</span> <span class="n">timing_fn</span><span class="p">(</span><span class="n">handle</span><span class="p">(</span><span class="n">ev</span> <span class="o">&lt;-</span> <span class="n">withCallingHandlers</span><span class="p">(</span><span class="n">withVisible</span><span class="p">(</span><span class="n">eval_with_user_handlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">,</span> <span class="n">user_handlers</span><span class="p">)),</span> <span class="n">warning</span> <span class="o">=</span> <span class="n">wHandler</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">eHandler</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">message</span> <span class="o">=</span> <span class="n">mHandler</span><span class="p">))),</span> <span class="n">handle</span><span class="p">(</span><span class="n">ev</span> <span class="o">&lt;-</span> <span class="n">withCallingHandlers</span><span class="p">(</span><span class="n">withVisible</span><span class="p">(</span><span class="n">eval_with_user_handlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">,</span> <span class="n">user_handlers</span><span class="p">)),</span> <span class="n">warning</span> <span class="o">=</span> <span class="n">wHandler</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">eHandler</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">message</span> <span class="o">=</span> <span class="n">mHandler</span><span class="p">)),</span> <span class="k">try</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">),</span> <span class="n">tryCatch</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">error</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">.</span>             <span class="n">call</span> <span class="o">&lt;-</span> <span class="n">conditionCall</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
  <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="o">(</span>call<span class="o">))</span><span class="w"> </span><span class="o">{</span>
  <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="n">identical</span><span class="p">(</span><span class="n">call</span><span class="p">[[</span><span class="mi">1</span><span class="n">L</span><span class="p">]],</span> <span class="n">quote</span><span class="p">(</span><span class="n">doTryCatch</span><span class="p">)))</span> 
  <span class="o">.</span>                   <span class="n">call</span> <span class="o">&lt;-</span> <span class="n">sys</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="n">L</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="n">dcall</span> <span class="o">&lt;-</span> <span class="n">deparse</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">nlines</span> <span class="o">=</span> <span class="mi">1</span><span class="n">L</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="n">prefix</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">&quot;Error in&quot;</span><span class="p">,</span> <span class="n">dcall</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="n">LONG</span> <span class="o">&lt;-</span> <span class="mi">75</span><span class="n">L</span>
  <span class="o">.</span>                 <span class="n">sm</span> <span class="o">&lt;-</span> <span class="n">strsplit</span><span class="p">(</span><span class="n">conditionMessage</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[[</span><span class="mi">1</span><span class="n">L</span><span class="p">]]</span>
  <span class="o">.</span>                 <span class="n">w</span> <span class="o">&lt;-</span> <span class="mi">14</span><span class="n">L</span> <span class="o">+</span> <span class="n">nchar</span><span class="p">(</span><span class="n">dcall</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">nchar</span><span class="p">(</span><span class="n">sm</span><span class="p">[</span><span class="mi">1</span><span class="n">L</span><span class="p">],</span> 
  <span class="o">.</span>                   <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">na</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> 
  <span class="o">.</span>                   <span class="n">w</span> <span class="o">&lt;-</span> <span class="mi">14</span><span class="n">L</span> <span class="o">+</span> <span class="n">nchar</span><span class="p">(</span><span class="n">dcall</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">nchar</span><span class="p">(</span><span class="n">sm</span><span class="p">[</span><span class="mi">1</span><span class="n">L</span><span class="p">],</span> 
  <span class="o">.</span>                     <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;</span> <span class="n">LONG</span><span class="p">)</span> 
  <span class="o">.</span>                   <span class="n">prefix</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="p">)</span>
  <span class="o">.</span>             <span class="p">}</span>
  <span class="o">.</span>             <span class="k">else</span> <span class="n">prefix</span> <span class="o">&lt;-</span> <span class="s2">&quot;Error : &quot;</span>
  <span class="o">.</span>             <span class="n">msg</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">conditionMessage</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="o">.</span>             <span class="o">.</span><span class="n">Internal</span><span class="p">(</span><span class="n">seterrmessage</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="n">L</span><span class="p">]))</span>
  <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="o">!</span>silent<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>isTRUE<span class="o">(</span>getOption<span class="o">(</span><span class="s2">&quot;show.error.messages&quot;</span><span class="o">)))</span><span class="w"> </span><span class="o">{</span>
  <span class="o">.</span>                 <span class="n">cat</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">outFile</span><span class="p">)</span>
  <span class="o">.</span>                 <span class="o">.</span><span class="n">Internal</span><span class="p">(</span><span class="n">printDeferredWarnings</span><span class="p">())</span>
  <span class="o">.</span>             <span class="p">}</span>
  <span class="o">.</span>             <span class="n">invisible</span><span class="p">(</span><span class="n">structure</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="k">class</span> <span class="err">= &quot;</span><span class="nc">try</span><span class="o">-</span><span class="n">error</span><span class="s2">&quot;, condition = e))</span>
  <span class="o">.</span>         <span class="p">}),</span> <span class="n">tryCatchList</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="n">tryCatchOne</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handlers</span><span class="p">[[</span><span class="mi">1</span><span class="n">L</span><span class="p">]]),</span> <span class="n">doTryCatch</span><span class="p">(</span><span class="k">return</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> 
  <span class="o">.</span>         <span class="n">name</span><span class="p">,</span> <span class="n">parentenv</span><span class="p">,</span> <span class="n">handler</span><span class="p">),</span> <span class="n">withCallingHandlers</span><span class="p">(</span><span class="n">withVisible</span><span class="p">(</span><span class="n">eval_with_user_handlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">,</span> <span class="n">user_handlers</span><span class="p">)),</span> <span class="n">warning</span> <span class="o">=</span> <span class="n">wHandler</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">eHandler</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">message</span> <span class="o">=</span> <span class="n">mHandler</span><span class="p">),</span> <span class="n">withVisible</span><span class="p">(</span><span class="n">eval_with_user_handlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">,</span> <span class="n">user_handlers</span><span class="p">)),</span> <span class="n">eval_with_user_handlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">,</span> <span class="n">user_handlers</span><span class="p">),</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">),</span> <span class="n">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="n">tibble_quos</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">),</span> <span class="n">set_repaired_names</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">repaired_names</span><span class="p">(</span><span class="n">names2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
  <span class="o">.</span>         <span class="n">repair_hint</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">subclass_name_repair_errors</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">vec_as_names</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> 
  <span class="o">.</span>             <span class="n">repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span> <span class="o">||</span> <span class="o">!</span>is_character<span class="o">(</span>.name_repair<span class="o">))</span>,<span class="w"> </span>
  <span class="o">.</span>         <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">withCallingHandlers</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">vctrs_error_names_cannot_be_empty</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">.</span>         <span class="n">abort_column_names_cannot_be_empty</span><span class="p">(</span><span class="n">detect_empty_names</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
  <span class="o">.</span>             <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> 
  <span class="o">.</span>             <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
  <span class="o">.</span>     <span class="p">},</span> <span class="n">vctrs_error_names_cannot_be_dot_dot</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">.</span>         <span class="n">abort_column_names_cannot_be_dot_dot</span><span class="p">(</span><span class="n">detect_dot_dot</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
  <span class="o">.</span>             <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
  <span class="o">.</span>     <span class="p">},</span> <span class="n">vctrs_error_names_must_be_unique</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">cnd</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">.</span>         <span class="n">abort_column_names_must_be_unique</span><span class="p">(</span><span class="n">detect_duplicates</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
  <span class="o">.</span>             <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
  <span class="o">.</span>     <span class="p">}),</span> <span class="n">vec_as_names</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span> <span class="o">||</span> 
  <span class="o">.</span>         <span class="o">!</span>is_character<span class="o">(</span>.name_repair<span class="o">))</span>,<span class="w"> </span><span class="sb">`</span>&lt;fn&gt;<span class="sb">`</span><span class="o">()</span>,<span class="w"> </span>validate_unique<span class="o">(</span><span class="nv">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>names,<span class="w"> </span>
  <span class="o">.</span>         <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">stop_names_must_be_unique</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="n">arg</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">stop_names</span><span class="p">(</span><span class="k">class</span> <span class="err">= &quot;</span><span class="nc">vctrs_error_names_must_be_unique</span><span class="s2">&quot;, </span>
  <span class="o">.</span>         <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">stop_vctrs</span><span class="p">(</span><span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="s2">&quot;vctrs_error_names&quot;</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">),</span> <span class="n">abort</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> 
  <span class="o">.</span>         <span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="s2">&quot;vctrs_error&quot;</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)),</span> 
  <span class="o">.</span>     <span class="n">parent</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="n">L</span><span class="p">,</span> <span class="mi">3</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="n">L</span><span class="p">,</span> <span class="mi">5</span><span class="n">L</span><span class="p">,</span> <span class="mi">6</span><span class="n">L</span><span class="p">,</span> <span class="mi">7</span><span class="n">L</span><span class="p">,</span> <span class="mi">6</span><span class="n">L</span><span class="p">,</span> <span class="mi">9</span><span class="n">L</span><span class="p">,</span> <span class="mi">10</span><span class="n">L</span><span class="p">,</span> <span class="mi">4</span><span class="n">L</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="mi">12</span><span class="n">L</span><span class="p">,</span> <span class="mi">13</span><span class="n">L</span><span class="p">,</span> <span class="mi">13</span><span class="n">L</span><span class="p">,</span> <span class="mi">15</span><span class="n">L</span><span class="p">,</span> <span class="mi">16</span><span class="n">L</span><span class="p">,</span> <span class="mi">17</span><span class="n">L</span><span class="p">,</span> <span class="mi">18</span><span class="n">L</span><span class="p">,</span> <span class="mi">19</span><span class="n">L</span><span class="p">,</span> <span class="mi">13</span><span class="n">L</span><span class="p">,</span> <span class="mi">13</span><span class="n">L</span><span class="p">,</span> <span class="mi">13</span><span class="n">L</span><span class="p">,</span> <span class="mi">23</span><span class="n">L</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="mi">24</span><span class="n">L</span><span class="p">,</span> <span class="mi">0</span><span class="n">L</span><span class="p">,</span> <span class="mi">26</span><span class="n">L</span><span class="p">,</span> <span class="mi">27</span><span class="n">L</span><span class="p">,</span> <span class="mi">28</span><span class="n">L</span><span class="p">,</span> <span class="mi">29</span><span class="n">L</span><span class="p">,</span> <span class="mi">30</span><span class="n">L</span><span class="p">,</span> <span class="mi">29</span><span class="n">L</span><span class="p">,</span> <span class="mi">32</span><span class="n">L</span><span class="p">,</span> <span class="mi">33</span><span class="n">L</span><span class="p">,</span> <span class="mi">34</span><span class="n">L</span><span class="p">,</span> <span class="mi">35</span><span class="n">L</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="mi">36</span><span class="n">L</span><span class="p">,</span> <span class="mi">37</span><span class="n">L</span><span class="p">),</span> <span class="n">visible</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">),</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;IRkernel&quot;</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span> <span class="s2">&quot;IRkernel&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">NA</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;tibble&quot;</span><span class="p">,</span> <span class="s2">&quot;tibble&quot;</span><span class="p">,</span> <span class="s2">&quot;tibble&quot;</span><span class="p">,</span> <span class="s2">&quot;tibble&quot;</span><span class="p">,</span> <span class="s2">&quot;tibble&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;rlang&quot;</span><span class="p">),</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;:::&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span>
  <span class="o">.</span>     <span class="p">),</span> <span class="n">error_frame</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">)),</span> <span class="n">row</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span> <span class="o">-</span><span class="mi">38</span><span class="n">L</span>
  <span class="o">.</span> <span class="p">),</span> <span class="n">version</span> <span class="o">=</span> <span class="mi">2</span><span class="n">L</span><span class="p">,</span> <span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="s2">&quot;rlang_trace&quot;</span><span class="p">,</span> <span class="s2">&quot;rlib_trace&quot;</span><span class="p">,</span> <span class="s2">&quot;tbl&quot;</span><span class="p">,</span> 
  <span class="o">.</span> <span class="s2">&quot;data.frame&quot;</span><span class="p">)),</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span>
  <span class="o">.</span> <span class="p">),</span> <span class="n">rlang</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inherit</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">),</span> <span class="n">call</span> <span class="o">=</span> <span class="n">repaired_names</span><span class="p">(</span><span class="n">names2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="n">repair_hint</span><span class="p">,</span> <span class="o">.</span><span class="n">name_repair</span> <span class="o">=</span> <span class="o">.</span><span class="n">name_repair</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)),</span> <span class="k">class</span> <span class="err">= </span><span class="nc">c</span><span class="p">(</span><span class="s2">&quot;vctrs_error_names_must_be_unique&quot;</span><span class="p">,</span> 
  <span class="o">.</span> <span class="s2">&quot;vctrs_error_names&quot;</span><span class="p">,</span> <span class="s2">&quot;vctrs_error&quot;</span><span class="p">,</span> <span class="s2">&quot;rlang_error&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;condition&quot;</span>
  <span class="o">.</span> <span class="p">)))</span>
<span class="mi">17</span><span class="o">.</span> <span class="n">abort_column_names_must_be_unique</span><span class="p">(</span><span class="n">detect_duplicates</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">cnd</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">repair_hint</span> <span class="o">=</span> <span class="n">repair_hint</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">18</span><span class="o">.</span> <span class="n">tibble_abort</span><span class="p">(</span><span class="n">invalid_df</span><span class="p">(</span><span class="s2">&quot;must not be duplicated&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">use_repair</span><span class="p">(</span><span class="n">repair_hint</span><span class="p">),</span> 
  <span class="o">.</span>     <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Column name(s)&quot;</span><span class="p">),</span> <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">,</span> 
  <span class="o">.</span>     <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">)</span>
<span class="mi">19</span><span class="o">.</span> <span class="n">abort</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">class</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">call</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">,</span> <span class="n">use_cli_format</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="mi">20</span><span class="o">.</span> <span class="n">signal_abort</span><span class="p">(</span><span class="n">cnd</span><span class="p">,</span> <span class="o">.</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;minimal&quot;</span><span class="p">)</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;unique&quot;</span><span class="p">)</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;universal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>x</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New names:
<span class=" -Color -Color-Cyan">•</span> `x` -&gt; `x...1`
<span class=" -Color -Color-Cyan">•</span> `x` -&gt; `x...2`
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x...1</th><th scope=col>x...2</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New names:
<span class=" -Color -Color-Cyan">•</span> `x` -&gt; `x...1`
<span class=" -Color -Color-Cyan">•</span> `x` -&gt; `x...2`
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x...1</th><th scope=col>x...2</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make.unique</span><span class="p">)</span><span class="w"> </span><span class="c1"># 指定修复函数</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="nf">make.unique</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">))</span>
<span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.name_repair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="nf">make.names</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>x.1</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>x_1</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>x.1</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>注意<code class="docutils literal notranslate"><span class="pre">make.unique(names,</span> <span class="pre">sep</span> <span class="pre">=</span> <span class="pre">&quot;.&quot;)</span></code>和<code class="docutils literal notranslate"><span class="pre">make.names(names,</span> <span class="pre">unique</span> <span class="pre">=</span> <span class="pre">FALSE,</span> <span class="pre">allow_</span> <span class="pre">=</span> <span class="pre">TRUE)</span></code> 是基础包的函数</p>
</section>
<section id="list-columns">
<h2><code class="docutils literal notranslate"><span class="pre">List-columns</span></code>(列表列)<a class="headerlink" href="#list-columns" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code> 本质上是向量构成的列表</p>
<ul class="simple">
<li><p><img alt="image.png" src="../_images/tibble.png.1" /></p></li>
</ul>
<p>大多情况下，我们接触到的向量是原子型向量(<code class="docutils literal notranslate"><span class="pre">atomic</span> <span class="pre">vectors</span></code>)，所谓原子型向量就是向量元素为单个值，比如 “<code class="docutils literal notranslate"><span class="pre">a</span></code>” 或者 <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
<ul class="simple">
<li><p><img alt="image-2.png" src="../_images/tibble-atomic.png" /></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>还有可以允许某一列为列表(<code class="docutils literal notranslate"><span class="pre">list</span></code>)，那么列表构成的列，称之为列表列（<code class="docutils literal notranslate"><span class="pre">list</span> <span class="pre">columns</span></code>）</p>
<ul class="simple">
<li><p><img alt="image-3.png" src="../_images/tibble-list-col.png" /></p></li>
</ul>
<p>这样一来，列表列非常灵活，因为列表元素可以是原子型向量、列表、矩阵或者小的<code class="docutils literal notranslate"><span class="pre">tibble</span></code></p>
<ul class="simple">
<li><p><img alt="image-4.png" src="../_images/tibble-list-col-vectors.png" /></p></li>
</ul>
</section>
<section id="nested-tibble">
<h2><code class="docutils literal notranslate"><span class="pre">nested</span> <span class="pre">tibble</span></code><a class="headerlink" href="#nested-tibble" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>的列表列装载数据的能力很强大，也很灵活。</p>
<p>如何创建和操控有列表列的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>。</p>
<section id="creating">
<h3>1 <code class="docutils literal notranslate"><span class="pre">creating</span></code><a class="headerlink" href="#creating" title="Link to this heading">#</a></h3>
<p>假定我们这里有一个<code class="docutils literal notranslate"><span class="pre">tibble</span></code>， 我们有三种方法可以创建列表列</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">nest()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">summarise()</span></code> and <code class="docutils literal notranslate"><span class="pre">list()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mutate()</span></code> and <code class="docutils literal notranslate"><span class="pre">map()</span></code></p>
<h3 class="rubric" id="tidyr-nest"><code class="docutils literal notranslate"><span class="pre">tidyr::nest()</span></code>创建</h3>
</li>
</ul>
<p>使用<code class="docutils literal notranslate"><span class="pre">tidyr::nest(data</span> <span class="pre">=</span> <span class="pre">c())</span></code>函数，创建有列表列的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>指定那几列合成列表列<code class="docutils literal notranslate"><span class="pre">data</span></code>。<img alt="image.png" src="../_images/tibble-list-col-tibbles.png" /></p>
<p>除了x列外的其他列就可用<code class="docutils literal notranslate"><span class="pre">nest(data</span> <span class="pre">=</span> <span class="pre">!x)</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># tidyr::nest()</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">palmerpenguins</span><span class="p">)</span>
<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">drop_na</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">bill_length_mm</span><span class="p">,</span><span class="w"> </span><span class="n">bill_depth_mm</span><span class="p">,</span><span class="w"> </span><span class="n">body_mass_g</span><span class="p">)</span>
<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>

<span class="n">tb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="n">tidyr</span><span class="o">::</span><span class="nf">nest</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">,</span><span class="w"> </span><span class="n">bill_depth_mm</span><span class="p">,</span><span class="w"> </span><span class="n">body_mass_g</span><span class="p">))</span>
<span class="n">tb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 4</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>bill_length_mm</th><th scope=col>bill_depth_mm</th><th scope=col>body_mass_g</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie</td><td>39.1</td><td>18.7</td><td>3750</td></tr>
	<tr><td>Adelie</td><td>39.5</td><td>17.4</td><td>3800</td></tr>
	<tr><td>Adelie</td><td>40.3</td><td>18.0</td><td>3250</td></tr>
	<tr><td>Adelie</td><td>36.7</td><td>19.3</td><td>3450</td></tr>
	<tr><td>Adelie</td><td>39.3</td><td>20.6</td><td>3650</td></tr>
	<tr><td>Adelie</td><td>38.9</td><td>17.8</td><td>3625</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5, 3750.0, 3800.0, 3250.0, 3450.0, 3650.0, 3625.0, 4675.0, 3200.0, 3800.0, 4400.0, 3700.0, 3450.0, 4500.0, 3325.0, 4200.0, 3400.0, 3600.0, 3800.0, 3950.0, 3800.0, 3800.0, 3550.0, 3200.0, 3150.0, 3950.0, 3250.0, 3900.0, 3300.0, 3900.0, 3325.0, 4150.0, 3950.0, 3550.0, 3300.0, 4650.0, 3150.0, 3900.0, 3100.0, 4400.0, 3000.0, 4600.0, 3425.0, 3450.0, 4150.0, 3500.0, 4300.0, 3450.0, 4050.0, 2900.0, 3700.0, 3550.0, 3800.0, 2850.0, 3750.0, 3150.0, 4400.0, 3600.0, 4050.0, 2850.0, 3950.0, 3350.0, 4100.0, 3050.0, 4450.0, 3600.0, 3900.0, 3550.0, 4150.0, 3700.0, 4250.0, 3700.0, 3900.0, 3550.0, 4000.0, 3200.0, 4700.0, 3800.0, 4200.0, 3350.0, 3550.0, 3800.0, 3500.0, 3950.0, 3600.0, 3550.0, 4300.0, 3400.0, 4450.0, 3300.0, 4300.0, 3700.0, 4350.0, 2900.0, 4100.0, 3725.0, 4725.0, 3075.0, 4250.0, 2925.0, 3550.0, 3750.0, 3900.0, 3175.0, 4775.0, 3825.0, 4600.0, 3200.0, 4275.0, 3900.0, 4075.0, 2900.0, 3775.0, 3350.0, 3325.0, 3150.0, 3500.0, 3450.0, 3875.0, 3050.0, 4000.0, 3275.0, 4300.0, 3050.0, 4000.0, 3325.0, 3500.0, 3500.0, 4475.0, 3425.0, 3900.0, 3175.0, 3975.0, 3400.0, 4250.0, 3400.0, 3475.0, 3050.0, 3725.0, 3000.0, 3650.0, 4250.0, 3475.0, 3450.0, 3750.0, 3700.0, 4000.0</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1, 4500.0, 5700.0, 4450.0, 5700.0, 5400.0, 4550.0, 4800.0, 5200.0, 4400.0, 5150.0, 4650.0, 5550.0, 4650.0, 5850.0, 4200.0, 5850.0, 4150.0, 6300.0, 4800.0, 5350.0, 5700.0, 5000.0, 4400.0, 5050.0, 5000.0, 5100.0, 5650.0, 4600.0, 5550.0, 5250.0, 4700.0, 5050.0, 6050.0, 5150.0, 5400.0, 4950.0, 5250.0, 4350.0, 5350.0, 3950.0, 5700.0, 4300.0, 4750.0, 5550.0, 4900.0, 4200.0, 5400.0, 5100.0, 5300.0, 4850.0, 5300.0, 4400.0, 5000.0, 4900.0, 5050.0, 4300.0, 5000.0, 4450.0, 5550.0, 4200.0, 5300.0, 4400.0, 5650.0, 4700.0, 5700.0, 5800.0, 4700.0, 5550.0, 4750.0, 5000.0, 5100.0, 5200.0, 4700.0, 5800.0, 4600.0, 6000.0, 4750.0, 5950.0, 4625.0, 5450.0, 4725.0, 5350.0, 4750.0, 5600.0, 4600.0, 5300.0, 4875.0, 5550.0, 4950.0, 5400.0, 4750.0, 5650.0, 4850.0, 5200.0, 4925.0, 4875.0, 4625.0, 5250.0, 4850.0, 5600.0, 4975.0, 5500.0, 5500.0, 4700.0, 5500.0, 4575.0, 5500.0, 5000.0, 5950.0, 4650.0, 5500.0, 4375.0, 5850.0, 6000.0, 4925.0, 4850.0, 5750.0, 5200.0, 5400.0</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7, 3500.0, 3900.0, 3650.0, 3525.0, 3725.0, 3950.0, 3250.0, 3750.0, 4150.0, 3700.0, 3800.0, 3775.0, 3700.0, 4050.0, 3575.0, 4050.0, 3300.0, 3700.0, 3450.0, 4400.0, 3600.0, 3400.0, 2900.0, 3800.0, 3300.0, 4150.0, 3400.0, 3800.0, 3700.0, 4550.0, 3200.0, 4300.0, 3350.0, 4100.0, 3600.0, 3900.0, 3850.0, 4800.0, 2700.0, 4500.0, 3950.0, 3650.0, 3550.0, 3500.0, 3675.0, 4450.0, 3400.0, 4300.0, 3250.0, 3675.0, 3325.0, 3950.0, 3600.0, 4050.0, 3350.0, 3450.0, 3250.0, 4050.0, 3800.0, 3525.0, 3950.0, 3650.0, 3650.0, 4000.0, 3400.0, 3775.0, 4100.0, 3775.0</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nest()</span> </code>为每种species创建了一个小的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>， 每个小的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>对应一个species</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span><span class="o">$</span><span class="n">data</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
<span class="n">tb</span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">typeof</span><span class="p">()</span>
<span class="n">tb</span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">class</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 3</caption>
<thead>
	<tr><th scope=col>bill_length_mm</th><th scope=col>bill_depth_mm</th><th scope=col>body_mass_g</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>39.1</td><td>18.7</td><td>3750</td></tr>
	<tr><td>39.5</td><td>17.4</td><td>3800</td></tr>
	<tr><td>40.3</td><td>18.0</td><td>3250</td></tr>
	<tr><td>36.7</td><td>19.3</td><td>3450</td></tr>
	<tr><td>39.3</td><td>20.6</td><td>3650</td></tr>
	<tr><td>38.9</td><td>17.8</td><td>3625</td></tr>
</tbody>
</table>
</div><div class="output text_html">'list'</div><div class="output text_html">'list'</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 除了species列之外的其他列组合成list_columns</span>
<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">nest</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">species</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5, 3750.0, 3800.0, 3250.0, 3450.0, 3650.0, 3625.0, 4675.0, 3200.0, 3800.0, 4400.0, 3700.0, 3450.0, 4500.0, 3325.0, 4200.0, 3400.0, 3600.0, 3800.0, 3950.0, 3800.0, 3800.0, 3550.0, 3200.0, 3150.0, 3950.0, 3250.0, 3900.0, 3300.0, 3900.0, 3325.0, 4150.0, 3950.0, 3550.0, 3300.0, 4650.0, 3150.0, 3900.0, 3100.0, 4400.0, 3000.0, 4600.0, 3425.0, 3450.0, 4150.0, 3500.0, 4300.0, 3450.0, 4050.0, 2900.0, 3700.0, 3550.0, 3800.0, 2850.0, 3750.0, 3150.0, 4400.0, 3600.0, 4050.0, 2850.0, 3950.0, 3350.0, 4100.0, 3050.0, 4450.0, 3600.0, 3900.0, 3550.0, 4150.0, 3700.0, 4250.0, 3700.0, 3900.0, 3550.0, 4000.0, 3200.0, 4700.0, 3800.0, 4200.0, 3350.0, 3550.0, 3800.0, 3500.0, 3950.0, 3600.0, 3550.0, 4300.0, 3400.0, 4450.0, 3300.0, 4300.0, 3700.0, 4350.0, 2900.0, 4100.0, 3725.0, 4725.0, 3075.0, 4250.0, 2925.0, 3550.0, 3750.0, 3900.0, 3175.0, 4775.0, 3825.0, 4600.0, 3200.0, 4275.0, 3900.0, 4075.0, 2900.0, 3775.0, 3350.0, 3325.0, 3150.0, 3500.0, 3450.0, 3875.0, 3050.0, 4000.0, 3275.0, 4300.0, 3050.0, 4000.0, 3325.0, 3500.0, 3500.0, 4475.0, 3425.0, 3900.0, 3175.0, 3975.0, 3400.0, 4250.0, 3400.0, 3475.0, 3050.0, 3725.0, 3000.0, 3650.0, 4250.0, 3475.0, 3450.0, 3750.0, 3700.0, 4000.0</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1, 4500.0, 5700.0, 4450.0, 5700.0, 5400.0, 4550.0, 4800.0, 5200.0, 4400.0, 5150.0, 4650.0, 5550.0, 4650.0, 5850.0, 4200.0, 5850.0, 4150.0, 6300.0, 4800.0, 5350.0, 5700.0, 5000.0, 4400.0, 5050.0, 5000.0, 5100.0, 5650.0, 4600.0, 5550.0, 5250.0, 4700.0, 5050.0, 6050.0, 5150.0, 5400.0, 4950.0, 5250.0, 4350.0, 5350.0, 3950.0, 5700.0, 4300.0, 4750.0, 5550.0, 4900.0, 4200.0, 5400.0, 5100.0, 5300.0, 4850.0, 5300.0, 4400.0, 5000.0, 4900.0, 5050.0, 4300.0, 5000.0, 4450.0, 5550.0, 4200.0, 5300.0, 4400.0, 5650.0, 4700.0, 5700.0, 5800.0, 4700.0, 5550.0, 4750.0, 5000.0, 5100.0, 5200.0, 4700.0, 5800.0, 4600.0, 6000.0, 4750.0, 5950.0, 4625.0, 5450.0, 4725.0, 5350.0, 4750.0, 5600.0, 4600.0, 5300.0, 4875.0, 5550.0, 4950.0, 5400.0, 4750.0, 5650.0, 4850.0, 5200.0, 4925.0, 4875.0, 4625.0, 5250.0, 4850.0, 5600.0, 4975.0, 5500.0, 5500.0, 4700.0, 5500.0, 4575.0, 5500.0, 5000.0, 5950.0, 4650.0, 5500.0, 4375.0, 5850.0, 6000.0, 4925.0, 4850.0, 5750.0, 5200.0, 5400.0</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7, 3500.0, 3900.0, 3650.0, 3525.0, 3725.0, 3950.0, 3250.0, 3750.0, 4150.0, 3700.0, 3800.0, 3775.0, 3700.0, 4050.0, 3575.0, 4050.0, 3300.0, 3700.0, 3450.0, 4400.0, 3600.0, 3400.0, 2900.0, 3800.0, 3300.0, 4150.0, 3400.0, 3800.0, 3700.0, 4550.0, 3200.0, 4300.0, 3350.0, 4100.0, 3600.0, 3900.0, 3850.0, 4800.0, 2700.0, 4500.0, 3950.0, 3650.0, 3550.0, 3500.0, 3675.0, 4450.0, 3400.0, 4300.0, 3250.0, 3675.0, 3325.0, 3950.0, 3600.0, 4050.0, 3350.0, 3450.0, 3250.0, 4050.0, 3800.0, 3525.0, 3950.0, 3650.0, 3650.0, 4000.0, 3400.0, 3775.0, 4100.0, 3775.0</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 同时创建多个列表列</span>
<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">nest</span><span class="p">(</span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">,</span><span class="w"> </span><span class="n">bill_depth_mm</span><span class="p">),</span><span class="w"> </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body_mass_g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data1</th><th scope=col>data2</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5</td><td>3750, 3800, 3250, 3450, 3650, 3625, 4675, 3200, 3800, 4400, 3700, 3450, 4500, 3325, 4200, 3400, 3600, 3800, 3950, 3800, 3800, 3550, 3200, 3150, 3950, 3250, 3900, 3300, 3900, 3325, 4150, 3950, 3550, 3300, 4650, 3150, 3900, 3100, 4400, 3000, 4600, 3425, 3450, 4150, 3500, 4300, 3450, 4050, 2900, 3700, 3550, 3800, 2850, 3750, 3150, 4400, 3600, 4050, 2850, 3950, 3350, 4100, 3050, 4450, 3600, 3900, 3550, 4150, 3700, 4250, 3700, 3900, 3550, 4000, 3200, 4700, 3800, 4200, 3350, 3550, 3800, 3500, 3950, 3600, 3550, 4300, 3400, 4450, 3300, 4300, 3700, 4350, 2900, 4100, 3725, 4725, 3075, 4250, 2925, 3550, 3750, 3900, 3175, 4775, 3825, 4600, 3200, 4275, 3900, 4075, 2900, 3775, 3350, 3325, 3150, 3500, 3450, 3875, 3050, 4000, 3275, 4300, 3050, 4000, 3325, 3500, 3500, 4475, 3425, 3900, 3175, 3975, 3400, 4250, 3400, 3475, 3050, 3725, 3000, 3650, 4250, 3475, 3450, 3750, 3700, 4000</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1</td><td>4500, 5700, 4450, 5700, 5400, 4550, 4800, 5200, 4400, 5150, 4650, 5550, 4650, 5850, 4200, 5850, 4150, 6300, 4800, 5350, 5700, 5000, 4400, 5050, 5000, 5100, 5650, 4600, 5550, 5250, 4700, 5050, 6050, 5150, 5400, 4950, 5250, 4350, 5350, 3950, 5700, 4300, 4750, 5550, 4900, 4200, 5400, 5100, 5300, 4850, 5300, 4400, 5000, 4900, 5050, 4300, 5000, 4450, 5550, 4200, 5300, 4400, 5650, 4700, 5700, 5800, 4700, 5550, 4750, 5000, 5100, 5200, 4700, 5800, 4600, 6000, 4750, 5950, 4625, 5450, 4725, 5350, 4750, 5600, 4600, 5300, 4875, 5550, 4950, 5400, 4750, 5650, 4850, 5200, 4925, 4875, 4625, 5250, 4850, 5600, 4975, 5500, 5500, 4700, 5500, 4575, 5500, 5000, 5950, 4650, 5500, 4375, 5850, 6000, 4925, 4850, 5750, 5200, 5400</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7</td><td>3500, 3900, 3650, 3525, 3725, 3950, 3250, 3750, 4150, 3700, 3800, 3775, 3700, 4050, 3575, 4050, 3300, 3700, 3450, 4400, 3600, 3400, 2900, 3800, 3300, 4150, 3400, 3800, 3700, 4550, 3200, 4300, 3350, 4100, 3600, 3900, 3850, 4800, 2700, 4500, 3950, 3650, 3550, 3500, 3675, 4450, 3400, 4300, 3250, 3675, 3325, 3950, 3600, 4050, 3350, 3450, 3250, 4050, 3800, 3525, 3950, 3650, 3650, 4000, 3400, 3775, 4100, 3775</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id14">
<h3>1 creating<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
</section>
<section id="tidyr-summarise-list">
<h3><code class="docutils literal notranslate"><span class="pre">tidyr::summarise(list())</span></code>创建<a class="headerlink" href="#tidyr-summarise-list" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">group_by()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">summarise()</span></code>组合可以将向量分组后分别压缩成单个值，事实上，<code class="docutils literal notranslate"><span class="pre">summarise()</span></code>还可以创建列表列。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_collpase</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">))</span>
<span class="n">df_collpase</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code>就是构建的列表列，它的每个元素都是一个向量，对应一个<code class="docutils literal notranslate"><span class="pre">species</span></code>。这种方法和<code class="docutils literal notranslate"><span class="pre">nest()</span></code>方法很相似，不同在于，<code class="docutils literal notranslate"><span class="pre">summarise()</span></code> + <code class="docutils literal notranslate"><span class="pre">list()</span></code> 构建的列表列其元素是原子型向量，而<code class="docutils literal notranslate"><span class="pre">nest()</span></code>构建的是<code class="docutils literal notranslate"><span class="pre">tibble</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_collpase</span><span class="o">$</span><span class="n">data</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">typeof</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'double'</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">summarise()</span></code> + <code class="docutils literal notranslate"><span class="pre">list()</span></code>的方法还可以在创建列表列之前，对数据简单处理</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 排序</span>
<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">)))</span>

<span class="c1"># 筛选</span>
<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">[</span><span class="n">bill_length_mm</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">45</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>32.1, 33.1, 33.5, 34.0, 34.4, 34.5, 34.6, 34.6, 35.0, 35.0, 35.1, 35.2, 35.3, 35.5, 35.5, 35.6, 35.7, 35.7, 35.7, 35.9, 35.9, 36.0, 36.0, 36.0, 36.0, 36.2, 36.2, 36.2, 36.3, 36.4, 36.4, 36.5, 36.5, 36.6, 36.6, 36.7, 36.7, 36.8, 36.9, 37.0, 37.0, 37.2, 37.2, 37.3, 37.3, 37.3, 37.5, 37.6, 37.6, 37.6, 37.7, 37.7, 37.7, 37.8, 37.8, 37.8, 37.9, 37.9, 38.1, 38.1, 38.1, 38.1, 38.2, 38.2, 38.3, 38.5, 38.6, 38.6, 38.6, 38.7, 38.8, 38.8, 38.8, 38.9, 38.9, 39.0, 39.0, 39.0, 39.1, 39.2, 39.2, 39.2, 39.3, 39.5, 39.5, 39.5, 39.6, 39.6, 39.6, 39.6, 39.6, 39.7, 39.7, 39.7, 39.7, 39.8, 40.1, 40.2, 40.2, 40.2, 40.3, 40.3, 40.5, 40.5, 40.6, 40.6, 40.6, 40.6, 40.7, 40.8, 40.8, 40.9, 40.9, 41.0, 41.1, 41.1, 41.1, 41.1, 41.1, 41.1, 41.1, 41.3, 41.3, 41.4, 41.4, 41.5, 41.5, 41.6, 41.8, 42.0, 42.1, 42.2, 42.2, 42.3, 42.5, 42.7, 42.8, 42.9, 43.1, 43.2, 43.2, 44.1, 44.1, 45.6, 45.8, 46.0</td></tr>
	<tr><td>Chinstrap</td><td>40.9, 42.4, 42.5, 42.5, 43.2, 43.5, 45.2, 45.2, 45.4, 45.5, 45.6, 45.7, 45.7, 45.9, 46.0, 46.1, 46.2, 46.4, 46.4, 46.5, 46.6, 46.7, 46.8, 46.9, 47.0, 47.5, 47.6, 48.1, 48.5, 49.0, 49.0, 49.2, 49.3, 49.5, 49.6, 49.7, 49.8, 50.0, 50.1, 50.2, 50.2, 50.3, 50.5, 50.5, 50.6, 50.7, 50.8, 50.8, 50.9, 50.9, 51.0, 51.3, 51.3, 51.3, 51.4, 51.5, 51.7, 51.9, 52.0, 52.0, 52.0, 52.2, 52.7, 52.8, 53.5, 54.2, 55.8, 58.0</td></tr>
	<tr><td>Gentoo   </td><td>40.9, 41.7, 42.0, 42.6, 42.7, 42.8, 42.9, 43.2, 43.3, 43.3, 43.4, 43.5, 43.5, 43.6, 43.8, 44.0, 44.4, 44.5, 44.9, 44.9, 45.0, 45.1, 45.1, 45.1, 45.2, 45.2, 45.2, 45.2, 45.3, 45.3, 45.4, 45.5, 45.5, 45.5, 45.5, 45.7, 45.8, 45.8, 46.1, 46.1, 46.2, 46.2, 46.2, 46.3, 46.4, 46.4, 46.5, 46.5, 46.5, 46.5, 46.6, 46.7, 46.8, 46.8, 46.8, 46.9, 47.2, 47.2, 47.3, 47.4, 47.5, 47.5, 47.5, 47.6, 47.7, 47.8, 48.1, 48.2, 48.2, 48.4, 48.4, 48.4, 48.5, 48.5, 48.6, 48.7, 48.7, 48.7, 48.8, 49.0, 49.1, 49.1, 49.1, 49.2, 49.3, 49.4, 49.5, 49.5, 49.6, 49.6, 49.8, 49.8, 49.9, 50.0, 50.0, 50.0, 50.0, 50.1, 50.2, 50.4, 50.4, 50.5, 50.5, 50.5, 50.7, 50.8, 50.8, 51.1, 51.1, 51.3, 51.5, 52.1, 52.2, 52.5, 53.4, 54.3, 55.1, 55.9, 59.6</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>46.0, 45.8, 45.6</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 48.5, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 54.2, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 49.6, 50.8, 50.2</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 46.8, 49.0, 45.5, 48.4, 45.8, 49.3, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 46.1, 47.8, 48.2, 50.0, 47.3, 45.1, 59.6, 49.1, 48.4, 48.7, 49.6, 45.3, 49.6, 50.5, 45.5, 50.5, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.5, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 50.8, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 53.4, 48.1, 50.5, 49.8, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id15">
<h3>1 creating<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
</section>
<section id="dplyr-mutate">
<h3><code class="docutils literal notranslate"><span class="pre">dplyr::mutate()</span></code>创建<a class="headerlink" href="#dplyr-mutate" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>第三种方法是用<code class="docutils literal notranslate"><span class="pre">rowwise()</span></code> + <code class="docutils literal notranslate"><span class="pre">mutate()</span></code>，比如，下面为每个岛屿(island) 创建一个与该岛企鹅数量等长的随机数向量，简单点说，这个岛屿上企鹅有多少只，那么随机数的个数就有多少个。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowwise()</span></code>对数据后续的操作按行进行</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">drop_na</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span>
<span class="w">    </span><span class="n">n_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">()</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span>
<span class="w">  </span><span class="nf">rowwise</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_num</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>n_num</th><th scope=col>random</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>146</td><td>1.236420854, 0.058598272, 0.747679874, 0.586278768, 0.438737160, -0.287537641, 1.133045806, -0.373954814, -0.195164959, 0.399717051, -0.148851397, -0.192797851, -1.230120028, 0.153025024, 0.872343047, -0.740619852, -0.611730620, -0.217983257, -0.189460047, -0.973954458, -1.036361459, 0.284206082, -0.827654680, -1.164263619, 1.178230978, -1.169450904, 0.667579005, 0.127807457, -0.631868306, -1.746392763, 2.175611719, 0.821713641, -0.046088370, 2.105540253, 2.139539371, -0.548505654, -0.733264749, 0.875223763, 0.528007289, 2.456495052, -0.412050599, 1.240704208, 0.378669000, 0.340683768, -0.679256959, 1.017650235, 0.040275816, -0.205921134, 0.219835706, 0.789203600, -0.835140429, -2.335475821, -0.023620477, -0.114781915, -0.499948603, 0.516480690, -0.743546710, 0.924009662, 0.852371984, 0.500899709, -0.234903531, -2.202927496, -1.603642668, 0.750569352, 0.512701816, -2.111379414, 0.635026961, 0.936210586, -0.089496997, -0.008420686, 1.972443438, 0.961411710, 0.191073712, -0.859583110, -0.755409933, -1.180940165, -1.208025394, 0.597708602, 0.413000911, 1.703813026, 0.084479758, -0.356711624, 1.542731090, 1.686840151, 2.312238511, 0.094231894, -1.423555797, -0.154550966, 0.562533880, 2.416083427, -0.387457539, -1.981286182, 1.354884181, 0.336187862, -1.804809540, 0.249469285, 0.664087696, -0.460201121, -1.090800526, -1.537694833, -0.075504693, 1.007416312, -1.454678101, -1.543915329, 0.839577836, 0.825052330, 0.369245895, -0.448539300, -0.057106618, -1.494522633, 0.507341954, -0.445404737, -0.280773287, -1.422925870, 0.966857570, -0.409252921, 1.175884668, -0.242148269, -0.340639964, 0.060047216, 0.209239991, 0.253589173, 0.292259911, -0.400052380, -0.005376802, -0.483114689, 1.172113333, 0.155623701, 0.207083660, 0.414160512, 0.438772178, 1.371961131, -0.561785717, 0.527234964, 1.247415150, -0.408849303, -0.531910211, 0.062683454, -0.709190635, -1.283558114, 1.811504358, 0.960077781, -0.204662423, -0.811287089, -0.828281985, 0.830985535</td></tr>
	<tr><td>Chinstrap</td><td> 68</td><td>-1.33148502, 0.20721003, -1.05620347, -1.41035518, -0.23283569, 1.95942292, -2.95849403, -0.04600433, -0.75130463, 0.30986372, -0.15446309, -0.46724031, 0.88461533, -0.94995403, 0.35203735, -0.47049619, 2.22637400, -1.68507192, -1.64746368, -0.31378081, -0.37791141, 0.79875279, 0.84094202, -0.20287822, -0.04708536, 0.68393686, -1.13909991, -1.20559102, -0.32443238, 1.30852977, -0.55422568, 1.78861584, 1.24449146, -0.71462053, 0.35134631, -1.64925640, 0.71870054, -0.99027650, -0.03632335, -0.45096807, 1.92038459, 0.08519594, 0.74995678, 0.24015577, -0.34055026, -0.24851411, -1.38847214, -0.11179605, -0.13705184, -0.61450812, 0.95323627, -0.91784688, 0.07129392, 0.94078221, -0.09263853, -0.75152984, -0.13402454, -1.48714657, -0.68098075, -0.03197984, -1.21807478, 0.58040069, 1.75319512, 0.64570769, 1.76911944, -0.88608024, -0.98096739, -0.64911726</td></tr>
	<tr><td>Gentoo   </td><td>119</td><td>0.1206178903, -1.1085620709, 0.4806708479, -1.4294746670, 0.5227428059, 0.8063283133, -0.5810337637, -1.0775182428, 0.4780391073, 0.1552280902, 2.4686767291, -0.5656660644, 0.7778722986, 0.9719173888, 0.9367344650, 0.6017891969, 0.3508255027, -1.8236415043, -0.3505602945, -1.2954456338, 0.9626556411, 1.3523297655, 0.1022159295, -0.0002157032, -1.3562357458, -0.8962866537, 1.9303620583, 2.0088827449, -1.5687737986, 0.5758590104, -0.1353355863, -0.1049712729, -0.5813035340, 0.3548372763, 0.0373397171, -0.4502060059, -2.4494848437, -0.6033287351, -0.5575028124, -0.2513607985, -1.2701313744, -0.3211480888, -1.9856924420, -0.8720330825, -1.4807107847, -0.3303593187, 1.3919121868, 1.9069334798, 0.6646663314, -1.5294152508, 1.3672316767, 0.9658540963, 0.1624850801, -0.6440596906, -0.7845236596, -2.2447959282, -1.4576901284, 1.3611109761, 0.5969105654, 0.3316033054, 1.3009486373, 0.9065209119, 0.5752653840, 0.5432625060, 0.8722508584, -0.6751973379, 1.4493031197, 0.1814196464, -1.1650791840, 0.7169177515, -0.4442789262, -1.3013650751, 0.1097926527, 0.0545293429, -0.2028182218, -0.2172361861, -0.9687751437, 0.3139943584, -1.5731406251, 0.2394670597, 0.4530442609, -1.2626116948, -0.4134241744, 0.7930906416, 0.3564965615, 0.1483177643, 0.1113727712, 0.7160701809, 1.4903930654, -0.6871089478, -0.2939674712, 0.6722377239, 0.2336864260, 0.5090760267, -0.1514486182, -0.1788784434, -0.5061381314, 0.3391482227, 0.7521615466, 0.5063911052, 0.5091418998, -1.4533921567, 0.8867181810, -0.6850976928, -0.9480634853, 0.5685672247, 2.2288691161, 1.4269427661, 0.4869040995, 0.2245295067, 0.8675997864, -0.2481008324, -0.6287879310, 0.2953713581, -0.1322214239, 0.2900677928, 0.8452144701, -1.6858147947, -0.2970845483</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="unnesting">
<h3>2 Unnesting<a class="headerlink" href="#unnesting" title="Link to this heading">#</a></h3>
<p>用<code class="docutils literal notranslate"><span class="pre">unnest(cols</span> <span class="pre">=</span> <span class="pre">)</span></code>函数可以把列表列转换成常规列的形式,也就是还原成正常样式</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5, 3750.0, 3800.0, 3250.0, 3450.0, 3650.0, 3625.0, 4675.0, 3200.0, 3800.0, 4400.0, 3700.0, 3450.0, 4500.0, 3325.0, 4200.0, 3400.0, 3600.0, 3800.0, 3950.0, 3800.0, 3800.0, 3550.0, 3200.0, 3150.0, 3950.0, 3250.0, 3900.0, 3300.0, 3900.0, 3325.0, 4150.0, 3950.0, 3550.0, 3300.0, 4650.0, 3150.0, 3900.0, 3100.0, 4400.0, 3000.0, 4600.0, 3425.0, 3450.0, 4150.0, 3500.0, 4300.0, 3450.0, 4050.0, 2900.0, 3700.0, 3550.0, 3800.0, 2850.0, 3750.0, 3150.0, 4400.0, 3600.0, 4050.0, 2850.0, 3950.0, 3350.0, 4100.0, 3050.0, 4450.0, 3600.0, 3900.0, 3550.0, 4150.0, 3700.0, 4250.0, 3700.0, 3900.0, 3550.0, 4000.0, 3200.0, 4700.0, 3800.0, 4200.0, 3350.0, 3550.0, 3800.0, 3500.0, 3950.0, 3600.0, 3550.0, 4300.0, 3400.0, 4450.0, 3300.0, 4300.0, 3700.0, 4350.0, 2900.0, 4100.0, 3725.0, 4725.0, 3075.0, 4250.0, 2925.0, 3550.0, 3750.0, 3900.0, 3175.0, 4775.0, 3825.0, 4600.0, 3200.0, 4275.0, 3900.0, 4075.0, 2900.0, 3775.0, 3350.0, 3325.0, 3150.0, 3500.0, 3450.0, 3875.0, 3050.0, 4000.0, 3275.0, 4300.0, 3050.0, 4000.0, 3325.0, 3500.0, 3500.0, 4475.0, 3425.0, 3900.0, 3175.0, 3975.0, 3400.0, 4250.0, 3400.0, 3475.0, 3050.0, 3725.0, 3000.0, 3650.0, 4250.0, 3475.0, 3450.0, 3750.0, 3700.0, 4000.0</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1, 4500.0, 5700.0, 4450.0, 5700.0, 5400.0, 4550.0, 4800.0, 5200.0, 4400.0, 5150.0, 4650.0, 5550.0, 4650.0, 5850.0, 4200.0, 5850.0, 4150.0, 6300.0, 4800.0, 5350.0, 5700.0, 5000.0, 4400.0, 5050.0, 5000.0, 5100.0, 5650.0, 4600.0, 5550.0, 5250.0, 4700.0, 5050.0, 6050.0, 5150.0, 5400.0, 4950.0, 5250.0, 4350.0, 5350.0, 3950.0, 5700.0, 4300.0, 4750.0, 5550.0, 4900.0, 4200.0, 5400.0, 5100.0, 5300.0, 4850.0, 5300.0, 4400.0, 5000.0, 4900.0, 5050.0, 4300.0, 5000.0, 4450.0, 5550.0, 4200.0, 5300.0, 4400.0, 5650.0, 4700.0, 5700.0, 5800.0, 4700.0, 5550.0, 4750.0, 5000.0, 5100.0, 5200.0, 4700.0, 5800.0, 4600.0, 6000.0, 4750.0, 5950.0, 4625.0, 5450.0, 4725.0, 5350.0, 4750.0, 5600.0, 4600.0, 5300.0, 4875.0, 5550.0, 4950.0, 5400.0, 4750.0, 5650.0, 4850.0, 5200.0, 4925.0, 4875.0, 4625.0, 5250.0, 4850.0, 5600.0, 4975.0, 5500.0, 5500.0, 4700.0, 5500.0, 4575.0, 5500.0, 5000.0, 5950.0, 4650.0, 5500.0, 4375.0, 5850.0, 6000.0, 4925.0, 4850.0, 5750.0, 5200.0, 5400.0</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7, 3500.0, 3900.0, 3650.0, 3525.0, 3725.0, 3950.0, 3250.0, 3750.0, 4150.0, 3700.0, 3800.0, 3775.0, 3700.0, 4050.0, 3575.0, 4050.0, 3300.0, 3700.0, 3450.0, 4400.0, 3600.0, 3400.0, 2900.0, 3800.0, 3300.0, 4150.0, 3400.0, 3800.0, 3700.0, 4550.0, 3200.0, 4300.0, 3350.0, 4100.0, 3600.0, 3900.0, 3850.0, 4800.0, 2700.0, 4500.0, 3950.0, 3650.0, 3550.0, 3500.0, 3675.0, 4450.0, 3400.0, 4300.0, 3250.0, 3675.0, 3325.0, 3950.0, 3600.0, 4050.0, 3350.0, 3450.0, 3250.0, 4050.0, 3800.0, 3525.0, 3950.0, 3650.0, 3650.0, 4000.0, 3400.0, 3775.0, 4100.0, 3775.0</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">unnest</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 4</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>bill_length_mm</th><th scope=col>bill_depth_mm</th><th scope=col>body_mass_g</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie</td><td>39.1</td><td>18.7</td><td>3750</td></tr>
	<tr><td>Adelie</td><td>39.5</td><td>17.4</td><td>3800</td></tr>
	<tr><td>Adelie</td><td>40.3</td><td>18.0</td><td>3250</td></tr>
	<tr><td>Adelie</td><td>36.7</td><td>19.3</td><td>3450</td></tr>
	<tr><td>Adelie</td><td>39.3</td><td>20.6</td><td>3650</td></tr>
	<tr><td>Adelie</td><td>38.9</td><td>17.8</td><td>3625</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="manipulating">
<h3>Manipulating<a class="headerlink" href="#manipulating" title="Link to this heading">#</a></h3>
<p>操控列表列是一件有趣的事情，我们常常会借助于行方向的操作(<code class="docutils literal notranslate"><span class="pre">rowwise</span></code>)。比如找出每个岛屿企鹅的数量，我们需要对<code class="docutils literal notranslate"><span class="pre">data</span></code>列表列的元素依次迭代，</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">rowwise</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">num_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A rowwise_df: 3 × 3</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th><th scope=col>num_species</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5, 3750.0, 3800.0, 3250.0, 3450.0, 3650.0, 3625.0, 4675.0, 3200.0, 3800.0, 4400.0, 3700.0, 3450.0, 4500.0, 3325.0, 4200.0, 3400.0, 3600.0, 3800.0, 3950.0, 3800.0, 3800.0, 3550.0, 3200.0, 3150.0, 3950.0, 3250.0, 3900.0, 3300.0, 3900.0, 3325.0, 4150.0, 3950.0, 3550.0, 3300.0, 4650.0, 3150.0, 3900.0, 3100.0, 4400.0, 3000.0, 4600.0, 3425.0, 3450.0, 4150.0, 3500.0, 4300.0, 3450.0, 4050.0, 2900.0, 3700.0, 3550.0, 3800.0, 2850.0, 3750.0, 3150.0, 4400.0, 3600.0, 4050.0, 2850.0, 3950.0, 3350.0, 4100.0, 3050.0, 4450.0, 3600.0, 3900.0, 3550.0, 4150.0, 3700.0, 4250.0, 3700.0, 3900.0, 3550.0, 4000.0, 3200.0, 4700.0, 3800.0, 4200.0, 3350.0, 3550.0, 3800.0, 3500.0, 3950.0, 3600.0, 3550.0, 4300.0, 3400.0, 4450.0, 3300.0, 4300.0, 3700.0, 4350.0, 2900.0, 4100.0, 3725.0, 4725.0, 3075.0, 4250.0, 2925.0, 3550.0, 3750.0, 3900.0, 3175.0, 4775.0, 3825.0, 4600.0, 3200.0, 4275.0, 3900.0, 4075.0, 2900.0, 3775.0, 3350.0, 3325.0, 3150.0, 3500.0, 3450.0, 3875.0, 3050.0, 4000.0, 3275.0, 4300.0, 3050.0, 4000.0, 3325.0, 3500.0, 3500.0, 4475.0, 3425.0, 3900.0, 3175.0, 3975.0, 3400.0, 4250.0, 3400.0, 3475.0, 3050.0, 3725.0, 3000.0, 3650.0, 4250.0, 3475.0, 3450.0, 3750.0, 3700.0, 4000.0</td><td>146</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1, 4500.0, 5700.0, 4450.0, 5700.0, 5400.0, 4550.0, 4800.0, 5200.0, 4400.0, 5150.0, 4650.0, 5550.0, 4650.0, 5850.0, 4200.0, 5850.0, 4150.0, 6300.0, 4800.0, 5350.0, 5700.0, 5000.0, 4400.0, 5050.0, 5000.0, 5100.0, 5650.0, 4600.0, 5550.0, 5250.0, 4700.0, 5050.0, 6050.0, 5150.0, 5400.0, 4950.0, 5250.0, 4350.0, 5350.0, 3950.0, 5700.0, 4300.0, 4750.0, 5550.0, 4900.0, 4200.0, 5400.0, 5100.0, 5300.0, 4850.0, 5300.0, 4400.0, 5000.0, 4900.0, 5050.0, 4300.0, 5000.0, 4450.0, 5550.0, 4200.0, 5300.0, 4400.0, 5650.0, 4700.0, 5700.0, 5800.0, 4700.0, 5550.0, 4750.0, 5000.0, 5100.0, 5200.0, 4700.0, 5800.0, 4600.0, 6000.0, 4750.0, 5950.0, 4625.0, 5450.0, 4725.0, 5350.0, 4750.0, 5600.0, 4600.0, 5300.0, 4875.0, 5550.0, 4950.0, 5400.0, 4750.0, 5650.0, 4850.0, 5200.0, 4925.0, 4875.0, 4625.0, 5250.0, 4850.0, 5600.0, 4975.0, 5500.0, 5500.0, 4700.0, 5500.0, 4575.0, 5500.0, 5000.0, 5950.0, 4650.0, 5500.0, 4375.0, 5850.0, 6000.0, 4925.0, 4850.0, 5750.0, 5200.0, 5400.0</td><td>119</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7, 3500.0, 3900.0, 3650.0, 3525.0, 3725.0, 3950.0, 3250.0, 3750.0, 4150.0, 3700.0, 3800.0, 3775.0, 3700.0, 4050.0, 3575.0, 4050.0, 3300.0, 3700.0, 3450.0, 4400.0, 3600.0, 3400.0, 2900.0, 3800.0, 3300.0, 4150.0, 3400.0, 3800.0, 3700.0, 4550.0, 3200.0, 4300.0, 3350.0, 4100.0, 3600.0, 3900.0, 3850.0, 4800.0, 2700.0, 4500.0, 3950.0, 3650.0, 3550.0, 3500.0, 3675.0, 4450.0, 3400.0, 4300.0, 3250.0, 3675.0, 3325.0, 3950.0, 3600.0, 4050.0, 3350.0, 3450.0, 3250.0, 4050.0, 3800.0, 3525.0, 3950.0, 3650.0, 3650.0, 4000.0, 3400.0, 3775.0, 4100.0, 3775.0</td><td> 68</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 求每组下企鹅嘴峰长度与嘴峰厚度的相关系数</span>
<span class="n">tb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">rowwise</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">corr_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">bill_length_mm</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">bill_depth_mm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A rowwise_df: 3 × 3</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>data</th><th scope=col>corr_coef</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Adelie   </td><td>39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37.9, 40.5, 39.5, 37.2, 39.5, 40.9, 36.4, 39.2, 38.8, 42.2, 37.6, 39.8, 36.5, 40.8, 36.0, 44.1, 37.0, 39.6, 41.1, 36.0, 42.3, 39.6, 40.1, 35.0, 42.0, 34.5, 41.4, 39.0, 40.6, 36.5, 37.6, 35.7, 41.3, 37.6, 41.1, 36.4, 41.6, 35.5, 41.1, 35.9, 41.8, 33.5, 39.7, 39.6, 45.8, 35.5, 42.8, 40.9, 37.2, 36.2, 42.1, 34.6, 42.9, 36.7, 35.1, 37.3, 41.3, 36.3, 36.9, 38.3, 38.9, 35.7, 41.1, 34.0, 39.6, 36.2, 40.8, 38.1, 40.3, 33.1, 43.2, 35.0, 41.0, 37.7, 37.8, 37.9, 39.7, 38.6, 38.2, 38.1, 43.2, 38.1, 45.6, 39.7, 42.2, 39.6, 42.7, 38.6, 37.3, 35.7, 41.1, 36.2, 37.7, 40.2, 41.4, 35.2, 40.6, 38.8, 41.5, 39.0, 44.1, 38.5, 43.1, 36.8, 37.5, 38.1, 41.1, 35.6, 40.2, 37.0, 39.7, 40.2, 40.6, 32.1, 40.7, 37.3, 39.0, 39.2, 36.6, 36.0, 37.8, 36.0, 41.5, 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18.6, 18.9, 16.7, 18.1, 17.8, 18.9, 17.0, 21.1, 20.0, 18.5, 19.3, 19.1, 18.0, 18.4, 18.5, 19.7, 16.9, 18.8, 19.0, 17.9, 21.2, 17.7, 18.9, 17.9, 19.5, 18.1, 18.6, 17.5, 18.8, 16.6, 19.1, 16.9, 21.1, 17.0, 18.2, 17.1, 18.0, 16.2, 19.1, 16.6, 19.4, 19.0, 18.4, 17.2, 18.9, 17.5, 18.5, 16.8, 19.4, 16.1, 19.1, 17.2, 17.6, 18.8, 19.4, 17.8, 20.3, 19.5, 18.6, 19.2, 18.8, 18.0, 18.1, 17.1, 18.1, 17.3, 18.9, 18.6, 18.5, 16.1, 18.5, 17.9, 20.0, 16.0, 20.0, 18.6, 18.9, 17.2, 20.0, 17.0, 19.0, 16.5, 20.3, 17.7, 19.5, 20.7, 18.3, 17.0, 20.5, 17.0, 18.6, 17.2, 19.8, 17.0, 18.5, 15.9, 19.0, 17.6, 18.3, 17.1, 18.0, 17.9, 19.2, 18.5, 18.5, 17.6, 17.5, 17.5, 20.1, 16.5, 17.9, 17.1, 17.2, 15.5, 17.0, 16.8, 18.7, 18.6, 18.4, 17.8, 18.1, 17.1, 18.5, 3750.0, 3800.0, 3250.0, 3450.0, 3650.0, 3625.0, 4675.0, 3200.0, 3800.0, 4400.0, 3700.0, 3450.0, 4500.0, 3325.0, 4200.0, 3400.0, 3600.0, 3800.0, 3950.0, 3800.0, 3800.0, 3550.0, 3200.0, 3150.0, 3950.0, 3250.0, 3900.0, 3300.0, 3900.0, 3325.0, 4150.0, 3950.0, 3550.0, 3300.0, 4650.0, 3150.0, 3900.0, 3100.0, 4400.0, 3000.0, 4600.0, 3425.0, 3450.0, 4150.0, 3500.0, 4300.0, 3450.0, 4050.0, 2900.0, 3700.0, 3550.0, 3800.0, 2850.0, 3750.0, 3150.0, 4400.0, 3600.0, 4050.0, 2850.0, 3950.0, 3350.0, 4100.0, 3050.0, 4450.0, 3600.0, 3900.0, 3550.0, 4150.0, 3700.0, 4250.0, 3700.0, 3900.0, 3550.0, 4000.0, 3200.0, 4700.0, 3800.0, 4200.0, 3350.0, 3550.0, 3800.0, 3500.0, 3950.0, 3600.0, 3550.0, 4300.0, 3400.0, 4450.0, 3300.0, 4300.0, 3700.0, 4350.0, 2900.0, 4100.0, 3725.0, 4725.0, 3075.0, 4250.0, 2925.0, 3550.0, 3750.0, 3900.0, 3175.0, 4775.0, 3825.0, 4600.0, 3200.0, 4275.0, 3900.0, 4075.0, 2900.0, 3775.0, 3350.0, 3325.0, 3150.0, 3500.0, 3450.0, 3875.0, 3050.0, 4000.0, 3275.0, 4300.0, 3050.0, 4000.0, 3325.0, 3500.0, 3500.0, 4475.0, 3425.0, 3900.0, 3175.0, 3975.0, 3400.0, 4250.0, 3400.0, 3475.0, 3050.0, 3725.0, 3000.0, 3650.0, 4250.0, 3475.0, 3450.0, 3750.0, 3700.0, 4000.0</td><td>0.3858132</td></tr>
	<tr><td>Gentoo   </td><td>46.1, 50.0, 48.7, 50.0, 47.6, 46.5, 45.4, 46.7, 43.3, 46.8, 40.9, 49.0, 45.5, 48.4, 45.8, 49.3, 42.0, 49.2, 46.2, 48.7, 50.2, 45.1, 46.5, 46.3, 42.9, 46.1, 47.8, 48.2, 50.0, 47.3, 42.8, 45.1, 59.6, 49.1, 48.4, 42.6, 44.4, 44.0, 48.7, 42.7, 49.6, 45.3, 49.6, 50.5, 43.6, 45.5, 50.5, 44.9, 45.2, 46.6, 48.5, 45.1, 50.1, 46.5, 45.0, 43.8, 45.5, 43.2, 50.4, 45.3, 46.2, 45.7, 54.3, 45.8, 49.8, 49.5, 43.5, 50.7, 47.7, 46.4, 48.2, 46.5, 46.4, 48.6, 47.5, 51.1, 45.2, 45.2, 49.1, 52.5, 47.4, 50.0, 44.9, 50.8, 43.4, 51.3, 47.5, 52.1, 47.5, 52.2, 45.5, 49.5, 44.5, 50.8, 49.4, 46.9, 48.4, 51.1, 48.5, 55.9, 47.2, 49.1, 46.8, 41.7, 53.4, 43.3, 48.1, 50.5, 49.8, 43.5, 51.5, 46.2, 55.1, 48.8, 47.2, 46.8, 50.4, 45.2, 49.9, 13.2, 16.3, 14.1, 15.2, 14.5, 13.5, 14.6, 15.3, 13.4, 15.4, 13.7, 16.1, 13.7, 14.6, 14.6, 15.7, 13.5, 15.2, 14.5, 15.1, 14.3, 14.5, 14.5, 15.8, 13.1, 15.1, 15.0, 14.3, 15.3, 15.3, 14.2, 14.5, 17.0, 14.8, 16.3, 13.7, 17.3, 13.6, 15.7, 13.7, 16.0, 13.7, 15.0, 15.9, 13.9, 13.9, 15.9, 13.3, 15.8, 14.2, 14.1, 14.4, 15.0, 14.4, 15.4, 13.9, 15.0, 14.5, 15.3, 13.8, 14.9, 13.9, 15.7, 14.2, 16.8, 16.2, 14.2, 15.0, 15.0, 15.6, 15.6, 14.8, 15.0, 16.0, 14.2, 16.3, 13.8, 16.4, 14.5, 15.6, 14.6, 15.9, 13.8, 17.3, 14.4, 14.2, 14.0, 17.0, 15.0, 17.1, 14.5, 16.1, 14.7, 15.7, 15.8, 14.6, 14.4, 16.5, 15.0, 17.0, 15.5, 15.0, 16.1, 14.7, 15.8, 14.0, 15.1, 15.2, 15.9, 15.2, 16.3, 14.1, 16.0, 16.2, 13.7, 14.3, 15.7, 14.8, 16.1, 4500.0, 5700.0, 4450.0, 5700.0, 5400.0, 4550.0, 4800.0, 5200.0, 4400.0, 5150.0, 4650.0, 5550.0, 4650.0, 5850.0, 4200.0, 5850.0, 4150.0, 6300.0, 4800.0, 5350.0, 5700.0, 5000.0, 4400.0, 5050.0, 5000.0, 5100.0, 5650.0, 4600.0, 5550.0, 5250.0, 4700.0, 5050.0, 6050.0, 5150.0, 5400.0, 4950.0, 5250.0, 4350.0, 5350.0, 3950.0, 5700.0, 4300.0, 4750.0, 5550.0, 4900.0, 4200.0, 5400.0, 5100.0, 5300.0, 4850.0, 5300.0, 4400.0, 5000.0, 4900.0, 5050.0, 4300.0, 5000.0, 4450.0, 5550.0, 4200.0, 5300.0, 4400.0, 5650.0, 4700.0, 5700.0, 5800.0, 4700.0, 5550.0, 4750.0, 5000.0, 5100.0, 5200.0, 4700.0, 5800.0, 4600.0, 6000.0, 4750.0, 5950.0, 4625.0, 5450.0, 4725.0, 5350.0, 4750.0, 5600.0, 4600.0, 5300.0, 4875.0, 5550.0, 4950.0, 5400.0, 4750.0, 5650.0, 4850.0, 5200.0, 4925.0, 4875.0, 4625.0, 5250.0, 4850.0, 5600.0, 4975.0, 5500.0, 5500.0, 4700.0, 5500.0, 4575.0, 5500.0, 5000.0, 5950.0, 4650.0, 5500.0, 4375.0, 5850.0, 6000.0, 4925.0, 4850.0, 5750.0, 5200.0, 5400.0</td><td>0.6540233</td></tr>
	<tr><td>Chinstrap</td><td>46.5, 50.0, 51.3, 45.4, 52.7, 45.2, 46.1, 51.3, 46.0, 51.3, 46.6, 51.7, 47.0, 52.0, 45.9, 50.5, 50.3, 58.0, 46.4, 49.2, 42.4, 48.5, 43.2, 50.6, 46.7, 52.0, 50.5, 49.5, 46.4, 52.8, 40.9, 54.2, 42.5, 51.0, 49.7, 47.5, 47.6, 52.0, 46.9, 53.5, 49.0, 46.2, 50.9, 45.5, 50.9, 50.8, 50.1, 49.0, 51.5, 49.8, 48.1, 51.4, 45.7, 50.7, 42.5, 52.2, 45.2, 49.3, 50.2, 45.6, 51.9, 46.8, 45.7, 55.8, 43.5, 49.6, 50.8, 50.2, 17.9, 19.5, 19.2, 18.7, 19.8, 17.8, 18.2, 18.2, 18.9, 19.9, 17.8, 20.3, 17.3, 18.1, 17.1, 19.6, 20.0, 17.8, 18.6, 18.2, 17.3, 17.5, 16.6, 19.4, 17.9, 19.0, 18.4, 19.0, 17.8, 20.0, 16.6, 20.8, 16.7, 18.8, 18.6, 16.8, 18.3, 20.7, 16.6, 19.9, 19.5, 17.5, 19.1, 17.0, 17.9, 18.5, 17.9, 19.6, 18.7, 17.3, 16.4, 19.0, 17.3, 19.7, 17.3, 18.8, 16.6, 19.9, 18.8, 19.4, 19.5, 16.5, 17.0, 19.8, 18.1, 18.2, 19.0, 18.7, 3500.0, 3900.0, 3650.0, 3525.0, 3725.0, 3950.0, 3250.0, 3750.0, 4150.0, 3700.0, 3800.0, 3775.0, 3700.0, 4050.0, 3575.0, 4050.0, 3300.0, 3700.0, 3450.0, 4400.0, 3600.0, 3400.0, 2900.0, 3800.0, 3300.0, 4150.0, 3400.0, 3800.0, 3700.0, 4550.0, 3200.0, 4300.0, 3350.0, 4100.0, 3600.0, 3900.0, 3850.0, 4800.0, 2700.0, 4500.0, 3950.0, 3650.0, 3550.0, 3500.0, 3675.0, 4450.0, 3400.0, 4300.0, 3250.0, 3675.0, 3325.0, 3950.0, 3600.0, 4050.0, 3350.0, 3450.0, 3250.0, 4050.0, 3800.0, 3525.0, 3950.0, 3650.0, 3650.0, 4000.0, 3400.0, 3775.0, 4100.0, 3775.0</td><td>0.6535362</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id16">
<h1>函数式编程1——<code class="docutils literal notranslate"><span class="pre">purrr</span></code><a class="headerlink" href="#id16" title="Link to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">R</span></code>常用的数据结构是向量、矩阵、列表和数据框
<img alt="image.png" src="../_images/data_structure1.png" /></p>
<p>他们构造起来，很多相似性。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1"># list</span>
<span class="w">           </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">     </span><span class="c1"># named vector</span>
<span class="w">  </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">     </span><span class="c1"># data frame</span>
<span class="w">      </span><span class="nf">tibble</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">     </span><span class="c1"># tibble</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$a</dt>
		<dd>1</dd>
	<dt>$b</dt>
		<dd>'a'</dd>
</dl>
</div><div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>a</dt><dd>1</dd><dt>b</dt><dd>2</dd></dl>
</div><div class="output text_html"><table class="dataframe">
<caption>A data.frame: 1 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 2</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div></div>
</div>
<section id="id17">
<h2>向量化运算<a class="headerlink" href="#id17" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>用<code class="docutils literal notranslate"><span class="pre">for()</span></code>循环，让向量的每个元素乘以<code class="docutils literal notranslate"><span class="pre">2</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">a</span><span class="p">)){</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 4
[1] 8
[1] 6
[1] 2
[1] 10
[1] 14
</pre></div>
</div>
</div>
</div>
<p>事实上，R语言是支持向量化（将运算符或者函数作用在向量的每一个元素上），可以用向量化代替循环</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>4</li><li>8</li><li>6</li><li>2</li><li>10</li><li>14</li></ol>
</div></div>
</div>
<p>再比如，找出向量a中元素大于2的所有值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">a</span><span class="p">)){</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span><span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 4
[1] 3
[1] 5
[1] 7
</pre></div>
</div>
</div>
</div>
<p>用向量化的运算，可以轻松实现</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">[</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>4</li><li>3</li><li>5</li><li>7</li></ol>
</div></div>
</div>
</section>
<section id="id18">
<h2>列表<a class="headerlink" href="#id18" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">  </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">),</span>
<span class="w">  </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span>
<span class="w">  </span><span class="n">cha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">a_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$num</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>8</li><li>9</li></ol>
</dd>
	<dt>$log</dt>
		<dd>TRUE</dd>
	<dt>$cha</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'a'</li><li>'b'</li><li>'c'</li></ol>
</dd>
</dl>
</div></div>
</div>
<p><strong>要想访问某个元素，可以这样</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span><span class="p">[</span><span class="s">&quot;log&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><strong>$log</strong> = TRUE</div></div>
</div>
<p>注意返回结果，第一行是<code class="docutils literal notranslate"><span class="pre">$log</span></code>，说明返回的结果仍然是列表, 相比<code class="docutils literal notranslate"><span class="pre">a_list</span></code>来说，<code class="docutils literal notranslate"><span class="pre">a_list[&quot;log&quot;]</span></code>是只包含一个元素的列表。</p>
<p>将<code class="docutils literal notranslate"><span class="pre">log</span></code>元素里面的向量提取出来，就得用两个<code class="docutils literal notranslate"><span class="pre">[[</span></code>或者<code class="docutils literal notranslate"><span class="pre">$</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span><span class="p">[[</span><span class="s">&quot;log&quot;</span><span class="p">]]</span>
<span class="n">a_list</span><span class="o">$</span><span class="n">log</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">TRUE</div><div class="output text_html">TRUE</div></div>
</div>
<p><img alt="image.png" src="../_images/list_subset.png" /></p>
<p>在tidyverse里，还可以用</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">pluck</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">a_list</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">pluck</span><span class="p">(</span><span class="s">&quot;num&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>8</li><li>9</li></ol>
</div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>8</li><li>9</li></ol>
</div></div>
</div>
</section>
<section id="vs">
<h2>列表 vs 向量<a class="headerlink" href="#vs" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>2</li><li>1</li><li>0</li><li>1</li><li>2</li></ol>
</div></div>
</div>
<p>如果是列表形式，<code class="docutils literal notranslate"><span class="pre">abs</span></code>函数应用到列表中就会报错</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lst</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">abs</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span> <span class="n">数学函数中用了非数值参数</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
<p>用在向量的函数用在<code class="docutils literal notranslate"><span class="pre">list</span></code>上，往往行不通。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">  </span><span class="n">student1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)),</span>
<span class="w">  </span><span class="n">student2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)),</span>
<span class="w">  </span><span class="n">student3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)),</span>
<span class="w">  </span><span class="n">student4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)),</span>
<span class="w">  </span><span class="n">student5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">exams</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>69</li><li>75</li><li>56</li><li>85</li><li>51</li><li>68</li><li>78</li><li>81</li><li>99</li><li>75</li></ol>
</dd>
	<dt>$student2</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>59</li><li>85</li><li>59</li><li>60</li><li>89</li><li>82</li><li>98</li><li>70</li><li>88</li><li>73</li></ol>
</dd>
	<dt>$student3</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>60</li><li>53</li><li>100</li><li>80</li><li>81</li><li>93</li><li>90</li><li>94</li><li>72</li><li>65</li></ol>
</dd>
	<dt>$student4</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>81</li><li>79</li><li>71</li><li>61</li><li>58</li><li>58</li><li>92</li><li>88</li><li>84</li><li>78</li></ol>
</dd>
	<dt>$student5</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>91</li><li>81</li><li>89</li><li>71</li><li>95</li><li>92</li><li>67</li><li>85</li><li>67</li><li>86</li></ol>
</dd>
</dl>
</div></div>
</div>
<p>对列表执行向量函数的运算会很不方便</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">list</span><span class="p">(</span>
<span class="w">  </span><span class="n">student1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">exams</span><span class="o">$</span><span class="n">student1</span><span class="p">),</span>
<span class="w">  </span><span class="n">student2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">exams</span><span class="o">$</span><span class="n">student2</span><span class="p">),</span>
<span class="w">  </span><span class="n">student3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">exams</span><span class="o">$</span><span class="n">student3</span><span class="p">),</span>
<span class="w">  </span><span class="n">student4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">exams</span><span class="o">$</span><span class="n">student4</span><span class="p">),</span>
<span class="w">  </span><span class="n">student5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">exams</span><span class="o">$</span><span class="n">student5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd>73.7</dd>
	<dt>$student2</dt>
		<dd>76.3</dd>
	<dt>$student3</dt>
		<dd>78.8</dd>
	<dt>$student4</dt>
		<dd>75</dd>
	<dt>$student5</dt>
		<dd>82.4</dd>
</dl>
</div></div>
</div>
</section>
<section id="id19">
<h2><code class="docutils literal notranslate"><span class="pre">purrr</span></code>包<a class="headerlink" href="#id19" title="Link to this heading">#</a></h2>
<p>对列表执行向量函数的运算</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">purrr</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="n">exams</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd>73.7</dd>
	<dt>$student2</dt>
		<dd>76.3</dd>
	<dt>$student3</dt>
		<dd>78.8</dd>
	<dt>$student4</dt>
		<dd>75</dd>
	<dt>$student5</dt>
		<dd>82.4</dd>
</dl>
</div></div>
</div>
<section id="map">
<h3>1 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数<a class="headerlink" href="#map" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">map()</span></code>函数的第一个参数是<code class="docutils literal notranslate"><span class="pre">list</span></code>或者<code class="docutils literal notranslate"><span class="pre">vector</span></code>， 第二个参数是函数</p>
<ul class="simple">
<li><p><img alt="image.png" src="../_images/map-step-1.png" /></p></li>
</ul>
<p>函数<code class="docutils literal notranslate"><span class="pre">f</span></code>应用到<code class="docutils literal notranslate"><span class="pre">list/vector</span></code>的每个元素</p>
<ul class="simple">
<li><p><img alt="image-2.png" src="../_images/map-step-2.png" /></p></li>
</ul>
<p>于是输入的 <code class="docutils literal notranslate"><span class="pre">list/vector</span></code> 中的每个元素，都对应一个输出</p>
<ul class="simple">
<li><p><img alt="image-3.png" src="../_images/map.png" /></p></li>
</ul>
<p>最后，所有的输出元素，聚合成一个新的<code class="docutils literal notranslate"><span class="pre">list</span></code></p>
<ul class="simple">
<li><p><img alt="image-4.png" src="../_images/map-output.png" /></p></li>
</ul>
<p>在我们这个例子，<code class="docutils literal notranslate"><span class="pre">mean()</span></code> 作用到每个学生的成绩向量，<img alt="image.png" src="../_images/map-mean.png" />
调用一次<code class="docutils literal notranslate"><span class="pre">mean()</span></code>, 返回一个数值，所以最终的结果是五个数值的列表。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 也可用管道</span>
<span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd>73.7</dd>
	<dt>$student2</dt>
		<dd>76.3</dd>
	<dt>$student3</dt>
		<dd>78.8</dd>
	<dt>$student4</dt>
		<dd>75</dd>
	<dt>$student5</dt>
		<dd>82.4</dd>
</dl>
</div></div>
</div>
</section>
<section id="id20">
<h3>2 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数家族<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">map_dbl()</span></code>返回的是数值型的向量</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">map_dbl()</span></code>要求每个输出的元素必须是数值型<img alt="image.png" src="../_images/map-dbl.png" /></p></li>
<li><p>如果每个元素是数值型，<code class="docutils literal notranslate"><span class="pre">map_dbl()</span></code>会聚合所有元素构成一个原子型向量<img alt="image-2.png" src="../_images/map-dbl-output.png" /></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">map_df()</span></code> 返回的结果是数据框</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_dbl</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>student1</dt><dd>73.7</dd><dt>student2</dt><dd>76.3</dd><dt>student3</dt><dd>78.8</dd><dt>student4</dt><dd>75</dd><dt>student5</dt><dd>82.4</dd></dl>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>73.7</td><td>76.3</td><td>78.8</td><td>75</td><td>82.4</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">map_df</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>73.7</td><td>76.3</td><td>78.8</td><td>75</td><td>82.4</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id21">
<h3>3 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数小结<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<p><img alt="image.png" src="../_images/map_function1.png" /></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">map</span></code>函数第一个参数是向量或列表（数据框是列表的一种特殊形式，因此数据框也是可以的）<img alt="image-2.png" src="../_images/map_fun.png" /></p></li>
<li><p>第二个参数是函数，这个函数会应用到列表的每一个元素，比如这里<code class="docutils literal notranslate"><span class="pre">map</span></code>函数执行过程如下<img alt="image-3.png" src="../_images/map_function2.png" /></p></li>
</ul>
<p>我们也可以根据需要，让<code class="docutils literal notranslate"><span class="pre">map</span></code>返回我们需要的数据格式, <code class="docutils literal notranslate"><span class="pre">purrr</span></code>也提供了方便的函数，具体如下<img alt="image.png" src="../_images/map_function3.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="w">  </span><span class="c1"># 方差</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>191.7889</td><td>199.1222</td><td>252.1778</td><td>154.4444</td><td>110.4889</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="id22">
<h3>4 额外参数<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>在<code class="docutils literal notranslate"><span class="pre">sort()</span></code>函数里添加参数 <code class="docutils literal notranslate"><span class="pre">decreasing</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>改为降序</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">map</span></code>很人性化，可以让函数的参数直接跟随在函数名之后,<code class="docutils literal notranslate"><span class="pre">map()</span></code>会自动的传递给函数。 <img alt="image.png" src="../_images/map-extra-arg.png" /></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map</span><span class="p">(</span><span class="n">exams</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">)</span><span class="w"> </span><span class="c1"># 默认升序</span>
<span class="nf">map</span><span class="p">(</span><span class="n">exams</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1"># 改为降序</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>51</li><li>56</li><li>68</li><li>69</li><li>75</li><li>75</li><li>78</li><li>81</li><li>85</li><li>99</li></ol>
</dd>
	<dt>$student2</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>59</li><li>59</li><li>60</li><li>70</li><li>73</li><li>82</li><li>85</li><li>88</li><li>89</li><li>98</li></ol>
</dd>
	<dt>$student3</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>53</li><li>60</li><li>65</li><li>72</li><li>80</li><li>81</li><li>90</li><li>93</li><li>94</li><li>100</li></ol>
</dd>
	<dt>$student4</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>58</li><li>58</li><li>61</li><li>71</li><li>78</li><li>79</li><li>81</li><li>84</li><li>88</li><li>92</li></ol>
</dd>
	<dt>$student5</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>67</li><li>67</li><li>71</li><li>81</li><li>85</li><li>86</li><li>89</li><li>91</li><li>92</li><li>95</li></ol>
</dd>
</dl>
</div><div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>99</li><li>85</li><li>81</li><li>78</li><li>75</li><li>75</li><li>69</li><li>68</li><li>56</li><li>51</li></ol>
</dd>
	<dt>$student2</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>98</li><li>89</li><li>88</li><li>85</li><li>82</li><li>73</li><li>70</li><li>60</li><li>59</li><li>59</li></ol>
</dd>
	<dt>$student3</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>100</li><li>94</li><li>93</li><li>90</li><li>81</li><li>80</li><li>72</li><li>65</li><li>60</li><li>53</li></ol>
</dd>
	<dt>$student4</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>92</li><li>88</li><li>84</li><li>81</li><li>79</li><li>78</li><li>71</li><li>61</li><li>58</li><li>58</li></ol>
</dd>
	<dt>$student5</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>95</li><li>92</li><li>91</li><li>89</li><li>86</li><li>85</li><li>81</li><li>71</li><li>67</li><li>67</li></ol>
</dd>
</dl>
</div></div>
</div>
</section>
<section id="id23">
<h3>5 匿名函数<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<p>我们也可以自定义函数。 比如我们这里定义了将向量<strong>中心化</strong>的函数（先求出10次考试的平均值，然后每次考试成绩去减这个平均值）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">my_fun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="n">my_fun</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 10 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> -4.7</td><td>-17.3</td><td>-18.8</td><td>  6</td><td>  8.6</td></tr>
	<tr><td>  1.3</td><td>  8.7</td><td>-25.8</td><td>  4</td><td> -1.4</td></tr>
	<tr><td>-17.7</td><td>-17.3</td><td> 21.2</td><td> -4</td><td>  6.6</td></tr>
	<tr><td> 11.3</td><td>-16.3</td><td>  1.2</td><td>-14</td><td>-11.4</td></tr>
	<tr><td>-22.7</td><td> 12.7</td><td>  2.2</td><td>-17</td><td> 12.6</td></tr>
	<tr><td> -5.7</td><td>  5.7</td><td> 14.2</td><td>-17</td><td>  9.6</td></tr>
	<tr><td>  4.3</td><td> 21.7</td><td> 11.2</td><td> 17</td><td>-15.4</td></tr>
	<tr><td>  7.3</td><td> -6.3</td><td> 15.2</td><td> 13</td><td>  2.6</td></tr>
	<tr><td> 25.3</td><td> 11.7</td><td> -6.8</td><td>  9</td><td>-15.4</td></tr>
	<tr><td>  1.3</td><td> -3.3</td><td>-13.8</td><td>  3</td><td>  3.6</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>我们也可以不用命名函数，而使用<strong>匿名函数</strong>。匿名函数顾名思义，就是没有名字的函数，</p>
<p>匿名函数直接放在<code class="docutils literal notranslate"><span class="pre">map()</span></code>函数中</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">map_df</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 10 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> -4.7</td><td>-17.3</td><td>-18.8</td><td>  6</td><td>  8.6</td></tr>
	<tr><td>  1.3</td><td>  8.7</td><td>-25.8</td><td>  4</td><td> -1.4</td></tr>
	<tr><td>-17.7</td><td>-17.3</td><td> 21.2</td><td> -4</td><td>  6.6</td></tr>
	<tr><td> 11.3</td><td>-16.3</td><td>  1.2</td><td>-14</td><td>-11.4</td></tr>
	<tr><td>-22.7</td><td> 12.7</td><td>  2.2</td><td>-17</td><td> 12.6</td></tr>
	<tr><td> -5.7</td><td>  5.7</td><td> 14.2</td><td>-17</td><td>  9.6</td></tr>
	<tr><td>  4.3</td><td> 21.7</td><td> 11.2</td><td> 17</td><td>-15.4</td></tr>
	<tr><td>  7.3</td><td> -6.3</td><td> 15.2</td><td> 13</td><td>  2.6</td></tr>
	<tr><td> 25.3</td><td> 11.7</td><td> -6.8</td><td>  9</td><td>-15.4</td></tr>
	<tr><td>  1.3</td><td> -3.3</td><td>-13.8</td><td>  3</td><td>  3.6</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>还可以更加偷懒，用<code class="docutils literal notranslate"><span class="pre">~</span></code>代替<code class="docutils literal notranslate"><span class="pre">function()</span></code>，但代价是参数必须是规定的写法，比如<code class="docutils literal notranslate"><span class="pre">.x</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="o">~</span><span class="n">.x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">.x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 10 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> -4.7</td><td>-17.3</td><td>-18.8</td><td>  6</td><td>  8.6</td></tr>
	<tr><td>  1.3</td><td>  8.7</td><td>-25.8</td><td>  4</td><td> -1.4</td></tr>
	<tr><td>-17.7</td><td>-17.3</td><td> 21.2</td><td> -4</td><td>  6.6</td></tr>
	<tr><td> 11.3</td><td>-16.3</td><td>  1.2</td><td>-14</td><td>-11.4</td></tr>
	<tr><td>-22.7</td><td> 12.7</td><td>  2.2</td><td>-17</td><td> 12.6</td></tr>
	<tr><td> -5.7</td><td>  5.7</td><td> 14.2</td><td>-17</td><td>  9.6</td></tr>
	<tr><td>  4.3</td><td> 21.7</td><td> 11.2</td><td> 17</td><td>-15.4</td></tr>
	<tr><td>  7.3</td><td> -6.3</td><td> 15.2</td><td> 13</td><td>  2.6</td></tr>
	<tr><td> 25.3</td><td> 11.7</td><td> -6.8</td><td>  9</td><td>-15.4</td></tr>
	<tr><td>  1.3</td><td> -3.3</td><td>-13.8</td><td>  3</td><td>  3.6</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>有时候，程序员觉得<code class="docutils literal notranslate"><span class="pre">x</span></code>还是有点多余，于是更够懒一点，只用<code class="docutils literal notranslate"><span class="pre">.</span></code>， 也是可以的</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="o">~</span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 10 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> -4.7</td><td>-17.3</td><td>-18.8</td><td>  6</td><td>  8.6</td></tr>
	<tr><td>  1.3</td><td>  8.7</td><td>-25.8</td><td>  4</td><td> -1.4</td></tr>
	<tr><td>-17.7</td><td>-17.3</td><td> 21.2</td><td> -4</td><td>  6.6</td></tr>
	<tr><td> 11.3</td><td>-16.3</td><td>  1.2</td><td>-14</td><td>-11.4</td></tr>
	<tr><td>-22.7</td><td> 12.7</td><td>  2.2</td><td>-17</td><td> 12.6</td></tr>
	<tr><td> -5.7</td><td>  5.7</td><td> 14.2</td><td>-17</td><td>  9.6</td></tr>
	<tr><td>  4.3</td><td> 21.7</td><td> 11.2</td><td> 17</td><td>-15.4</td></tr>
	<tr><td>  7.3</td><td> -6.3</td><td> 15.2</td><td> 13</td><td>  2.6</td></tr>
	<tr><td> 25.3</td><td> 11.7</td><td> -6.8</td><td>  9</td><td>-15.4</td></tr>
	<tr><td>  1.3</td><td> -3.3</td><td>-13.8</td><td>  3</td><td>  3.6</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">~</span> </code>告诉 <code class="docutils literal notranslate"><span class="pre">map()</span></code> 后面跟随的是一个匿名函数，<code class="docutils literal notranslate"><span class="pre">.</span></code> 对应函数的参数，可以认为是一个占位符，等待传送带的student1、student2到student5 依次传递到函数机器。<img alt="image.png" src="../_images/map-anonymous.png" /></p>
<p>如果熟悉匿名函数的写法，会增强代码的可读性</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">map_df</span><span class="p">(</span><span class="o">~</span><span class="nf">length</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="n">.</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">80</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>3</td><td>5</td><td>5</td><td>4</td><td>7</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>总之，有三种方法将函数传递给<code class="docutils literal notranslate"><span class="pre">map()</span></code></p>
<ul class="simple">
<li><p>直接传递</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">vctrs_vec_compat</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">purrr_user_env</span><span class="p">):</span> <span class="n">找不到对象</span><span class="s1">&#39;.x&#39;</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="nb">map</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">rm</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">map_</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="o">.</span><span class="n">progress</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">vctrs_vec_compat</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">purrr_user_env</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>匿名函数</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="nf">funcition</span><span class="p">(</span><span class="n">.x</span><span class="p">){</span><span class="nf">mean</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">parse</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">srcfile</span> <span class="o">=</span> <span class="n">src</span><span class="p">):</span> <span class="o">&lt;</span><span class="n">text</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span> <span class="n">意外的</span><span class="s1">&#39;{&#39;</span>
<span class="mi">1</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">funcition</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">){</span>
                         <span class="o">^</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">~</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">function</span><span class="p">(</span><span class="n">.x</span><span class="p">){</span><span class="n">.x</span><span class="o">*</span><span class="m">2</span><span class="p">}</span>

<span class="o">~</span><span class="n">.x</span><span class="o">*</span><span class="m">2</span>

<span class="nf">map</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">mean</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class=language-r><code>function (.x) 
{
<span style=white-space:pre-wrap>    .x * 2</span>
}</code></pre></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>~.x * 2
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">vctrs_vec_compat</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">purrr_user_env</span><span class="p">):</span> <span class="n">找不到对象</span><span class="s1">&#39;.x&#39;</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="nb">map</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">~</span><span class="n">mean</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">rm</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">))</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">map_</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="o">.</span><span class="n">progress</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">vctrs_vec_compat</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">purrr_user_env</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dplyrmap">
<h2>在<code class="docutils literal notranslate"><span class="pre">dplyr</span></code>函数中的运用<code class="docutils literal notranslate"><span class="pre">map</span></code><a class="headerlink" href="#dplyrmap" title="Link to this heading">#</a></h2>
<section id="id24">
<h3>1 在<code class="docutils literal notranslate"><span class="pre">Tibble</span></code>中<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Tibble</span></code>本质上是向量构成的列表，因此<code class="docutils literal notranslate"><span class="pre">tibble</span></code>也适用<code class="docutils literal notranslate"><span class="pre">map</span></code>。假定有<code class="docutils literal notranslate"><span class="pre">tibble</span></code>如下</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span>
<span class="w">  </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">    </span><span class="n">col_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">col_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="m">300</span><span class="p">),</span>
<span class="w">    </span><span class="n">col_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">map()</span></code>中的函数<code class="docutils literal notranslate"><span class="pre">f</span></code>，可以作用到每一列</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map_df</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 3</caption>
<thead>
	<tr><th scope=col>col_1</th><th scope=col>col_2</th><th scope=col>col_3</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>2</td><td>200</td><td>0.2</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>在比如，找出企鹅数据中每列缺失值<code class="docutils literal notranslate"><span class="pre">NA</span></code>的数量</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">palmerpenguins</span><span class="o">::</span><span class="n">penguins</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">map_df</span><span class="p">(</span><span class="o">~</span><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">.</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 8</caption>
<thead>
	<tr><th scope=col>species</th><th scope=col>island</th><th scope=col>bill_length_mm</th><th scope=col>bill_depth_mm</th><th scope=col>flipper_length_mm</th><th scope=col>body_mass_g</th><th scope=col>sex</th><th scope=col>year</th></tr>
	<tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0</td><td>0</td><td>2</td><td>2</td><td>2</td><td>2</td><td>11</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="col-column">
<h3>2 在<code class="docutils literal notranslate"><span class="pre">col-column</span></code>中<a class="headerlink" href="#col-column" title="Link to this heading">#</a></h3>
<p>如果想显示列表中每个元素的长度，可以这样写</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purrr</span><span class="o">::</span><span class="nf">map_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>length</th></tr>
	<tr><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>1</td></tr>
	<tr><td>2, 3</td><td>2</td></tr>
	<tr><td>4, 5, 6</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>用于各种函数，比如产生随机数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purrr</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 2</caption>
<thead>
	<tr><th scope=col>x</th><th scope=col>r</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>3</td><td>2.1274677, 1.1414248, 0.6160071</td></tr>
	<tr><td>5</td><td>0.4911994, -0.8412960, 1.0579460, -3.2319407, 0.5809908</td></tr>
	<tr><td>6</td><td>0.1515973, 0.3560650, -0.4892471, -0.7398517, -1.1858031, -1.6737861</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>用于建模</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">nest</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purrr</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purrr</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">(</span><span class="n">.</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">unnest</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A grouped_df: 6 × 8</caption>
<thead>
	<tr><th scope=col>cyl</th><th scope=col>data</th><th scope=col>model</th><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>6</td><td>21.000, 21.000, 21.400, 18.100, 19.200, 17.800, 19.700, 160.000, 160.000, 258.000, 225.000, 167.600, 167.600, 145.000, 110.000, 110.000, 110.000, 105.000, 123.000, 123.000, 175.000, 3.900, 3.900, 3.080, 2.760, 3.920, 3.920, 3.620, 2.620, 2.875, 3.215, 3.460, 3.440, 3.440, 2.770, 16.460, 17.020, 19.440, 20.220, 18.300, 18.900, 15.500, 0.000, 0.000, 1.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 0.000, 0.000, 0.000, 0.000, 1.000, 4.000, 4.000, 3.000, 3.000, 4.000, 4.000, 5.000, 4.000, 4.000, 1.000, 1.000, 4.000, 4.000, 6.000</td><td>28.40884, -2.780106, -0.124967, 0.5839601, 1.929196, -0.689678, 0.3547199, -1.04528, -1.007951, -52.23469, -2.426656, 2.111436, -0.3526643, 0.679099, -0.720901, -1.10683, 2, 21.12497, 20.41604, 19.4708, 18.78968, 18.84528, 18.84528, 20.70795, 0, 1, -2.645751, 0.3779645, 0.3779645, 0.3779645, 0.3779645, 0.3779645, 0.3779645, -8.247185, 0.8728647, -0.2683341, -0.5490191, -0.526106, -0.526106, 0.2414814, 1.377964, 1.121188, 1, 2, 1e-07, 2, 5, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 21, 21, 21.4, 18.1, 19.2, 17.8, 19.7, 2.62, 2.875, 3.215, 3.46, 3.44, 3.44, 2.77</td><td>(Intercept)</td><td>28.408845</td><td>4.1843688</td><td> 6.789278</td><td>1.054844e-03</td></tr>
	<tr><td>6</td><td>21.000, 21.000, 21.400, 18.100, 19.200, 17.800, 19.700, 160.000, 160.000, 258.000, 225.000, 167.600, 167.600, 145.000, 110.000, 110.000, 110.000, 105.000, 123.000, 123.000, 175.000, 3.900, 3.900, 3.080, 2.760, 3.920, 3.920, 3.620, 2.620, 2.875, 3.215, 3.460, 3.440, 3.440, 2.770, 16.460, 17.020, 19.440, 20.220, 18.300, 18.900, 15.500, 0.000, 0.000, 1.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 0.000, 0.000, 0.000, 0.000, 1.000, 4.000, 4.000, 3.000, 3.000, 4.000, 4.000, 5.000, 4.000, 4.000, 1.000, 1.000, 4.000, 4.000, 6.000</td><td>28.40884, -2.780106, -0.124967, 0.5839601, 1.929196, -0.689678, 0.3547199, -1.04528, -1.007951, -52.23469, -2.426656, 2.111436, -0.3526643, 0.679099, -0.720901, -1.10683, 2, 21.12497, 20.41604, 19.4708, 18.78968, 18.84528, 18.84528, 20.70795, 0, 1, -2.645751, 0.3779645, 0.3779645, 0.3779645, 0.3779645, 0.3779645, 0.3779645, -8.247185, 0.8728647, -0.2683341, -0.5490191, -0.526106, -0.526106, 0.2414814, 1.377964, 1.121188, 1, 2, 1e-07, 2, 5, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 21, 21, 21.4, 18.1, 19.2, 17.8, 19.7, 2.62, 2.875, 3.215, 3.46, 3.44, 3.44, 2.77</td><td>wt         </td><td>-2.780106</td><td>1.3349173</td><td>-2.082605</td><td>9.175766e-02</td></tr>
	<tr><td>4</td><td>22.800, 24.400, 22.800, 32.400, 30.400, 33.900, 21.500, 27.300, 26.000, 30.400, 21.400, 108.000, 146.700, 140.800, 78.700, 75.700, 71.100, 120.100, 79.000, 120.300, 95.100, 121.000, 93.000, 62.000, 95.000, 66.000, 52.000, 65.000, 97.000, 66.000, 91.000, 113.000, 109.000, 3.850, 3.690, 3.920, 4.080, 4.930, 4.220, 3.700, 4.080, 4.430, 3.770, 4.110, 2.320, 3.190, 3.150, 2.200, 1.615, 1.835, 2.465, 1.935, 2.140, 1.513, 2.780, 18.610, 20.000, 22.900, 19.470, 18.520, 19.900, 20.010, 18.900, 16.700, 16.900, 18.600, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 1.000, 0.000, 0.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 1.000, 1.000, 4.000, 4.000, 4.000, 4.000, 4.000, 4.000, 3.000, 4.000, 5.000, 5.000, 4.000, 1.000, 2.000, 2.000, 1.000, 2.000, 1.000, 1.000, 1.000, 2.000, 2.000, 2.000</td><td>39.5712, -5.647025, -3.670097, 2.842815, 1.016934, 5.25226, -0.05125022, 4.691095, -4.151279, -1.344202, -1.486562, -0.6272468, -2.472466, -88.43328, 10.17096, 0.6947654, 6.230721, 1.728126, 6.169273, -3.535624, -0.00293297, -0.4259551, 1.291776, -2.288073, 2, 26.4701, 21.55719, 21.78307, 27.14774, 30.45125, 29.2089, 25.65128, 28.6442, 27.48656, 31.02725, 23.87247, 0, 1, -3.316625, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, -7.5809, -1.801119, 0.4754451, -0.05200489, -0.376803, -0.2546567, 0.0951259, -0.1991357, -0.08531752, -0.4334345, 0.2700172, 1.301511, 1.497654, 1, 2, 1e-07, 2, 9, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 22.8, 24.4, 22.8, 32.4, 30.4, 33.9, 21.5, 27.3, 26, 30.4, 21.4, 2.32, 3.19, 3.15, 2.2, 1.615, 1.835, 2.465, 1.935, 2.14, 1.513, 2.78</td><td>(Intercept)</td><td>39.571196</td><td>4.3465820</td><td> 9.103980</td><td>7.771511e-06</td></tr>
	<tr><td>4</td><td>22.800, 24.400, 22.800, 32.400, 30.400, 33.900, 21.500, 27.300, 26.000, 30.400, 21.400, 108.000, 146.700, 140.800, 78.700, 75.700, 71.100, 120.100, 79.000, 120.300, 95.100, 121.000, 93.000, 62.000, 95.000, 66.000, 52.000, 65.000, 97.000, 66.000, 91.000, 113.000, 109.000, 3.850, 3.690, 3.920, 4.080, 4.930, 4.220, 3.700, 4.080, 4.430, 3.770, 4.110, 2.320, 3.190, 3.150, 2.200, 1.615, 1.835, 2.465, 1.935, 2.140, 1.513, 2.780, 18.610, 20.000, 22.900, 19.470, 18.520, 19.900, 20.010, 18.900, 16.700, 16.900, 18.600, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 1.000, 0.000, 0.000, 1.000, 1.000, 1.000, 0.000, 1.000, 1.000, 1.000, 1.000, 4.000, 4.000, 4.000, 4.000, 4.000, 4.000, 3.000, 4.000, 5.000, 5.000, 4.000, 1.000, 2.000, 2.000, 1.000, 2.000, 1.000, 1.000, 1.000, 2.000, 2.000, 2.000</td><td>39.5712, -5.647025, -3.670097, 2.842815, 1.016934, 5.25226, -0.05125022, 4.691095, -4.151279, -1.344202, -1.486562, -0.6272468, -2.472466, -88.43328, 10.17096, 0.6947654, 6.230721, 1.728126, 6.169273, -3.535624, -0.00293297, -0.4259551, 1.291776, -2.288073, 2, 26.4701, 21.55719, 21.78307, 27.14774, 30.45125, 29.2089, 25.65128, 28.6442, 27.48656, 31.02725, 23.87247, 0, 1, -3.316625, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, 0.3015113, -7.5809, -1.801119, 0.4754451, -0.05200489, -0.376803, -0.2546567, 0.0951259, -0.1991357, -0.08531752, -0.4334345, 0.2700172, 1.301511, 1.497654, 1, 2, 1e-07, 2, 9, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 22.8, 24.4, 22.8, 32.4, 30.4, 33.9, 21.5, 27.3, 26, 30.4, 21.4, 2.32, 3.19, 3.15, 2.2, 1.615, 1.835, 2.465, 1.935, 2.14, 1.513, 2.78</td><td>wt         </td><td>-5.647025</td><td>1.8501185</td><td>-3.052251</td><td>1.374278e-02</td></tr>
	<tr><td>8</td><td>18.700, 14.300, 16.400, 17.300, 15.200, 10.400, 10.400, 14.700, 15.500, 15.200, 13.300, 19.200, 15.800, 15.000, 360.000, 360.000, 275.800, 275.800, 275.800, 472.000, 460.000, 440.000, 318.000, 304.000, 350.000, 400.000, 351.000, 301.000, 175.000, 245.000, 180.000, 180.000, 180.000, 205.000, 215.000, 230.000, 150.000, 150.000, 245.000, 175.000, 264.000, 335.000, 3.150, 3.210, 3.070, 3.070, 3.070, 2.930, 3.000, 3.230, 2.760, 3.150, 3.730, 3.080, 4.220, 3.540, 3.440, 3.570, 4.070, 3.730, 3.780, 5.250, 5.424, 5.345, 3.520, 3.435, 3.840, 3.845, 3.170, 3.570, 17.020, 15.840, 17.400, 17.600, 18.000, 17.980, 17.820, 17.420, 16.870, 17.300, 15.410, 17.050, 14.500, 14.600, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 1.000, 1.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 5.000, 5.000, 2.000, 4.000, 3.000, 3.000, 3.000, 4.000, 4.000, 4.000, 2.000, 2.000, 4.000, 2.000, 4.000, 8.000</td><td>23.86803, -2.192438, 2.373957, -1.741026, 1.455193, 1.609764, -0.3806137, -1.95773, -1.576246, 2.550552, -0.6506476, -1.137005, -2.149067, 3.761895, -1.118001, -1.041026, -56.49903, -6.003055, 0.8157971, 1.220314, -0.8068206, -3.464586, -3.211015, 0.9738578, -0.8857193, -1.30959, -2.619382, 3.287904, -1.095775, -1.312854, 2, 16.32604, 16.04103, 14.94481, 15.69024, 15.58061, 12.35773, 11.97625, 12.14945, 16.15065, 16.337, 15.44907, 15.43811, 16.918, 16.04103, 0, 1, -3.741657, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, -14.96369, 2.738073, -0.06892519, 0.05524975, 0.03698873, -0.4998852, -0.5634336, -0.5345812, 0.131946, 0.1629898, 0.0150755, 0.0132494, 0.2597732, 0.113685, 1.267261, 1.113685, 1, 2, 1e-07, 2, 12, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 18.7, 14.3, 16.4, 17.3, 15.2, 10.4, 10.4, 14.7, 15.5, 15.2, 13.3, 19.2, 15.8, 15, 3.44, 3.57, 4.07, 3.73, 3.78, 5.25, 5.424, 5.345, 3.52, 3.435, 3.84, 3.845, 3.17, 3.57</td><td>(Intercept)</td><td>23.868029</td><td>3.0054619</td><td> 7.941551</td><td>4.052705e-06</td></tr>
	<tr><td>8</td><td>18.700, 14.300, 16.400, 17.300, 15.200, 10.400, 10.400, 14.700, 15.500, 15.200, 13.300, 19.200, 15.800, 15.000, 360.000, 360.000, 275.800, 275.800, 275.800, 472.000, 460.000, 440.000, 318.000, 304.000, 350.000, 400.000, 351.000, 301.000, 175.000, 245.000, 180.000, 180.000, 180.000, 205.000, 215.000, 230.000, 150.000, 150.000, 245.000, 175.000, 264.000, 335.000, 3.150, 3.210, 3.070, 3.070, 3.070, 2.930, 3.000, 3.230, 2.760, 3.150, 3.730, 3.080, 4.220, 3.540, 3.440, 3.570, 4.070, 3.730, 3.780, 5.250, 5.424, 5.345, 3.520, 3.435, 3.840, 3.845, 3.170, 3.570, 17.020, 15.840, 17.400, 17.600, 18.000, 17.980, 17.820, 17.420, 16.870, 17.300, 15.410, 17.050, 14.500, 14.600, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 1.000, 1.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 3.000, 5.000, 5.000, 2.000, 4.000, 3.000, 3.000, 3.000, 4.000, 4.000, 4.000, 2.000, 2.000, 4.000, 2.000, 4.000, 8.000</td><td>23.86803, -2.192438, 2.373957, -1.741026, 1.455193, 1.609764, -0.3806137, -1.95773, -1.576246, 2.550552, -0.6506476, -1.137005, -2.149067, 3.761895, -1.118001, -1.041026, -56.49903, -6.003055, 0.8157971, 1.220314, -0.8068206, -3.464586, -3.211015, 0.9738578, -0.8857193, -1.30959, -2.619382, 3.287904, -1.095775, -1.312854, 2, 16.32604, 16.04103, 14.94481, 15.69024, 15.58061, 12.35773, 11.97625, 12.14945, 16.15065, 16.337, 15.44907, 15.43811, 16.918, 16.04103, 0, 1, -3.741657, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, 0.2672612, -14.96369, 2.738073, -0.06892519, 0.05524975, 0.03698873, -0.4998852, -0.5634336, -0.5345812, 0.131946, 0.1629898, 0.0150755, 0.0132494, 0.2597732, 0.113685, 1.267261, 1.113685, 1, 2, 1e-07, 2, 12, lm(formula = mpg ~ wt, data = .), mpg ~ wt, 18.7, 14.3, 16.4, 17.3, 15.2, 10.4, 10.4, 14.7, 15.5, 15.2, 13.3, 19.2, 15.8, 15, 3.44, 3.57, 4.07, 3.73, 3.78, 5.25, 5.424, 5.345, 3.52, 3.435, 3.84, 3.845, 3.17, 3.57</td><td>wt         </td><td>-2.192438</td><td>0.7392393</td><td>-2.965803</td><td>1.179281e-02</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># midify会修改原始数据，推荐使用map</span>
<span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">map_df</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">.</span><span class="p">))</span>

<span class="n">exams</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 10 × 5</caption>
<thead>
	<tr><th scope=col>student1</th><th scope=col>student2</th><th scope=col>student3</th><th scope=col>student4</th><th scope=col>student5</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td> -4.7</td><td>-17.3</td><td>-18.8</td><td>  6</td><td>  8.6</td></tr>
	<tr><td>  1.3</td><td>  8.7</td><td>-25.8</td><td>  4</td><td> -1.4</td></tr>
	<tr><td>-17.7</td><td>-17.3</td><td> 21.2</td><td> -4</td><td>  6.6</td></tr>
	<tr><td> 11.3</td><td>-16.3</td><td>  1.2</td><td>-14</td><td>-11.4</td></tr>
	<tr><td>-22.7</td><td> 12.7</td><td>  2.2</td><td>-17</td><td> 12.6</td></tr>
	<tr><td> -5.7</td><td>  5.7</td><td> 14.2</td><td>-17</td><td>  9.6</td></tr>
	<tr><td>  4.3</td><td> 21.7</td><td> 11.2</td><td> 17</td><td>-15.4</td></tr>
	<tr><td>  7.3</td><td> -6.3</td><td> 15.2</td><td> 13</td><td>  2.6</td></tr>
	<tr><td> 25.3</td><td> 11.7</td><td> -6.8</td><td>  9</td><td>-15.4</td></tr>
	<tr><td>  1.3</td><td> -3.3</td><td>-13.8</td><td>  3</td><td>  3.6</td></tr>
</tbody>
</table>
</div><div class="output text_html"><dl>
	<dt>$student1</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>-4.7</li><li>1.3</li><li>-17.7</li><li>11.3</li><li>-22.7</li><li>-5.7</li><li>4.3</li><li>7.3</li><li>25.3</li><li>1.3</li></ol>
</dd>
	<dt>$student2</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>-17.3</li><li>8.7</li><li>-17.3</li><li>-16.3</li><li>12.7</li><li>5.7</li><li>21.7</li><li>-6.3</li><li>11.7</li><li>-3.3</li></ol>
</dd>
	<dt>$student3</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>-18.8</li><li>-25.8</li><li>21.2</li><li>1.2</li><li>2.2</li><li>14.2</li><li>11.2</li><li>15.2</li><li>-6.8</li><li>-13.8</li></ol>
</dd>
	<dt>$student4</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>6</li><li>4</li><li>-4</li><li>-14</li><li>-17</li><li>-17</li><li>17</li><li>13</li><li>9</li><li>3</li></ol>
</dd>
	<dt>$student5</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>8.59999999999999</li><li>-1.40000000000001</li><li>6.59999999999999</li><li>-11.4</li><li>12.6</li><li>9.59999999999999</li><li>-15.4</li><li>2.59999999999999</li><li>-15.4</li><li>3.59999999999999</li></ol>
</dd>
</dl>
</div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id25">
<h1>函数式编程2<a class="headerlink" href="#id25" title="Link to this heading">#</a></h1>
<p>事实上，<code class="docutils literal notranslate"><span class="pre">purrr()</span></code>家族还有其它<code class="docutils literal notranslate"><span class="pre">map()</span></code>函数，可以在多个向量中迭代。也就说，同时接受多个向量的元素，并行计算。比如，<code class="docutils literal notranslate"><span class="pre">map2()</span></code>函数可以处理两个向量，而<code class="docutils literal notranslate"><span class="pre">pmap()</span></code>函数可以处理更多向量。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="map2">
<h2><code class="docutils literal notranslate"><span class="pre">map2()</span></code><a class="headerlink" href="#map2" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">map2()</span></code>函数和<code class="docutils literal notranslate"><span class="pre">map()</span></code>函数类似，不同在于<code class="docutils literal notranslate"><span class="pre">map2()</span></code>接受两个的向量，这两个向量必须是等长<img alt="image.png" src="../_images/map2.png" />
在<code class="docutils literal notranslate"><span class="pre">map()</span></code>函数使用匿名函数，可以用 <code class="docutils literal notranslate"><span class="pre">.</span></code> 代表输入向量的每个元素。在<code class="docutils literal notranslate"><span class="pre">map2()</span></code>函数， <code class="docutils literal notranslate"><span class="pre">.</span></code>不够用，所有需要需要用 <code class="docutils literal notranslate"><span class="pre">.x</span></code> 代表第一个向量的元素，<code class="docutils literal notranslate"><span class="pre">.y</span></code>代表第二个向量的元素</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)</span>

<span class="nf">map2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">.x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">.y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol>
	<li>5</li>
	<li>7</li>
	<li>9</li>
</ol>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>的每一列都是向量，所以可以把<code class="docutils literal notranslate"><span class="pre">map2()</span></code>放在<code class="docutils literal notranslate"><span class="pre">mutate()</span></code>函数内部，对<code class="docutils literal notranslate"><span class="pre">tibble</span></code>的多列同时迭代</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">min</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">.y</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th><th scope=col>min</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>4</td><td>1</td></tr>
	<tr><td>2</td><td>5</td><td>2</td></tr>
	<tr><td>3</td><td>6</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>也可以简写</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map2_dbl</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th><th scope=col>min</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>4</td><td>1</td></tr>
	<tr><td>2</td><td>5</td><td>2</td></tr>
	<tr><td>3</td><td>6</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mutate()</span></code> 是<code class="docutils literal notranslate"><span class="pre">column-operation</span></code>，即提取数据框一列作为向量，传递到<code class="docutils literal notranslate"><span class="pre">mutate</span></code>中，<code class="docutils literal notranslate"><span class="pre">map2_dbl()</span></code>返回的也是一个等长的向量。</p>
<p>因此，也可以用<code class="docutils literal notranslate"><span class="pre">rowwise()</span></code>逐行应用函数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">rowwise</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 3</caption>
<thead>
	<tr><th scope=col>a</th><th scope=col>b</th><th scope=col>min</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>4</td><td>1</td></tr>
	<tr><td>2</td><td>5</td><td>2</td></tr>
	<tr><td>3</td><td>6</td><td>3</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="pmap">
<h2><code class="docutils literal notranslate"><span class="pre">pmap()</span></code><a class="headerlink" href="#pmap" title="Link to this heading">#</a></h2>
<p>没有<code class="docutils literal notranslate"><span class="pre">map3()</span></code>或者<code class="docutils literal notranslate"><span class="pre">map4()</span></code>函数，只有 <code class="docutils literal notranslate"><span class="pre">pmap()</span></code> 函数可用(<code class="docutils literal notranslate"><span class="pre">p</span></code> 的意思是 <code class="docutils literal notranslate"><span class="pre">parallel</span></code>)</p>
<p><code class="docutils literal notranslate"><span class="pre">purrr::pmap()</span></code>函数稍微有点不一样的地方:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">map()</span></code>和<code class="docutils literal notranslate"><span class="pre">map2()</span></code>函数，指定传递给函数<code class="docutils literal notranslate"><span class="pre">f</span></code>的向量，向量各自放在各自的位置上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pmap()</span></code>需要将传递给函数的向量名，先装入一个<code class="docutils literal notranslate"><span class="pre">list()</span></code>中, 再传递给函数<code class="docutils literal notranslate"><span class="pre">f</span></code><img alt="image.png" src="../_images/pmap-list.png" />
翻转列表的图示，参数的传递关系看地更清楚。<img alt="image-2.png" src="../_images/pmap-flipped.png" /></p></li>
</ul>
<p>事实上，<code class="docutils literal notranslate"><span class="pre">map2()</span></code>是<code class="docutils literal notranslate"><span class="pre">pmap()</span></code>的一种特殊情况</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">map2_dbl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>1</li><li>2</li><li>3</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pmap_dbl</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">min</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>1</li><li>2</li><li>3</li></ol>
</div></div>
</div>
<section id="id26">
<h3>1 用在<code class="docutils literal notranslate"><span class="pre">tibble</span></code><a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tibble</span></code>本质上就是<code class="docutils literal notranslate"><span class="pre">list</span></code>，这种结构就是<code class="docutils literal notranslate"><span class="pre">pmap()</span></code>所需要的，因此，直接应用函数即可。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">70</span><span class="p">),</span>
<span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">),</span>
<span class="w">  </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">105</span><span class="p">,</span><span class="w"> </span><span class="m">200</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">pmap_dbl</span><span class="p">(</span><span class="n">min</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>1</li><li>60</li><li>40</li></ol>
</div></div>
</div>
</section>
<section id="id27">
<h3>2 匿名函数<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pmap()</span></code>可以接受多个向量，因此在<code class="docutils literal notranslate"><span class="pre">pmap()</span></code>中使用匿名函数，就需要一种新的方法来标识每个向量。</p>
<p>由于向量是多个，因此不再用<code class="docutils literal notranslate"><span class="pre">.x</span></code>， <code class="docutils literal notranslate"><span class="pre">.y</span></code>，而是用<code class="docutils literal notranslate"><span class="pre">..1</span></code>, <code class="docutils literal notranslate"><span class="pre">..2</span></code>, <code class="docutils literal notranslate"><span class="pre">..3</span></code> 分别代表第一个向量、第二个向量和第三个向量。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pmap</span><span class="p">(</span>
<span class="w">  </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="o">~</span><span class="kc">..1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">..2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">..3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol>
	<li>8</li>
	<li>8</li>
	<li>8</li>
	<li>8</li>
	<li>8</li>
</ol>
</div></div>
</div>
</section>
<section id="id28">
<h3>3 命名函数<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">runif()</span></code>产生均匀分布随机数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="o">::</span><span class="nf">tribble</span><span class="p">(</span>
<span class="w">  </span><span class="o">~</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">max</span><span class="p">,</span>
<span class="w">   </span><span class="m">1L</span><span class="p">,</span><span class="w">     </span><span class="m">0</span><span class="p">,</span><span class="w">     </span><span class="m">1</span><span class="p">,</span>
<span class="w">   </span><span class="m">2L</span><span class="p">,</span><span class="w">    </span><span class="m">10</span><span class="p">,</span><span class="w">   </span><span class="m">100</span><span class="p">,</span>
<span class="w">   </span><span class="m">3L</span><span class="p">,</span><span class="w">   </span><span class="m">100</span><span class="p">,</span><span class="w">  </span><span class="m">1000</span>
<span class="p">)</span>
<span class="nf">pmap</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">runif</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">..1</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">..2</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">..3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol>
	<li>0.141139706131071</li>
	<li><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>84.9272603914142</li><li>76.684370811563</li></ol>
</li>
	<li><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>996.545916609466</li><li>739.936783257872</li><li>558.389809820801</li></ol>
</li>
</ol>
</div></div>
</div>
<p>如果提供给<code class="docutils literal notranslate"><span class="pre">pmap()</span></code>的<code class="docutils literal notranslate"><span class="pre">.f</span></code> 是命名函数，比如<code class="docutils literal notranslate"><span class="pre">runif(n,</span> <span class="pre">min</span> <span class="pre">=</span> <span class="pre">,</span> <span class="pre">max</span> <span class="pre">=</span> <span class="pre">)</span></code>，它有三个参数 <code class="docutils literal notranslate"><span class="pre">n</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>， 而我们输入的列表刚好也有三个同名的元素，那么他们会自动匹配，代码因此变得更加简练</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">pmap</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">runif</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol>
	<li>0.219966531032696</li>
	<li><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>60.3675597347319</li><li>64.8331752652302</li></ol>
</li>
	<li><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>134.005528269336</li><li>617.118727508932</li><li>748.147374158725</li></ol>
</li>
</ol>
</div></div>
</div>
<p>当然，这里需要注意的是</p>
<ul class="simple">
<li><p>输入列表的元素，其个数要与函数的参数个数一致</p></li>
<li><p>输入列表的元素，其变量名也要与函数的参数名一致</p></li>
</ul>
</section>
</section>
<section id="id29">
<h2>其他<code class="docutils literal notranslate"><span class="pre">purrr</span></code>函数<a class="headerlink" href="#id29" title="Link to this heading">#</a></h2>
<section id="map-functions-that-output-tibbles">
<h3>1 Map functions that output tibbles<a class="headerlink" href="#map-functions-that-output-tibbles" title="Link to this heading">#</a></h3>
<p>接着介绍<code class="docutils literal notranslate"><span class="pre">purrr</span></code>宏包的其他函数。 <code class="docutils literal notranslate"><span class="pre">map()</span></code>家族除了返回<code class="docutils literal notranslate"><span class="pre">list</span></code>和<code class="docutils literal notranslate"><span class="pre">atomic</span> <span class="pre">vector</span></code> 外，<code class="docutils literal notranslate"><span class="pre">map_df()</span></code>, <code class="docutils literal notranslate"><span class="pre">map_dfr()</span></code> 和<code class="docutils literal notranslate"><span class="pre">map_dfc()</span></code>还可以返回<code class="docutils literal notranslate"><span class="pre">tibble</span></code>。</p>
<p>这个过程，好比生产线上的工人把输入的列表元素依次转换成一个个<code class="docutils literal notranslate"><span class="pre">tibble</span></code>，<img alt="image.png" src="../_images/map_df.png" />
最后归集一个大的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>。在归集成一个大的<code class="docutils literal notranslate"><span class="pre">tibble</span></code>的时候，有两种方式，</p>
<ul class="simple">
<li><p>竖着堆积，<code class="docutils literal notranslate"><span class="pre">map_dfr()</span></code>(r for rows)<img alt="image-2.png" src="../_images/map_dfr.png" /></p></li>
<li><p>并排堆放<code class="docutils literal notranslate"><span class="pre">map_dfc()</span></code>(c for columns)<img alt="image-3.png" src="../_images/map_dfc.png" /></p></li>
</ul>
</section>
<section id="walk-and-friends">
<h3>2 Walk and friends<a class="headerlink" href="#walk-and-friends" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">walk()</span></code>函数与<code class="docutils literal notranslate"><span class="pre">map()</span></code>系列函数类似，但应用场景不同，<code class="docutils literal notranslate"><span class="pre">map()</span></code>在于执行函数操作，而<code class="docutils literal notranslate"><span class="pre">walk()</span></code> 保存记录数据（比如<code class="docutils literal notranslate"><span class="pre">print()</span></code>,<code class="docutils literal notranslate"><span class="pre">write.csv()</span></code>, <code class="docutils literal notranslate"><span class="pre">ggsave()</span></code>），常用于保存数据和生成图片。比如我们用<code class="docutils literal notranslate"><span class="pre">map()</span></code>生成系列图片，</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">plot_rnorm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">sd</span><span class="p">){</span>
<span class="w">    </span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5000</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">      </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">plots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span>
<span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">map</span><span class="p">(</span><span class="n">plot_rnorm</span><span class="p">)</span>

<span class="n">plots</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">walk</span><span class="p">(</span><span class="n">print</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/988fb0dc960d95c7667ba992583dc9a57414fad858a24668f289842fdcb5e620.png" src="../_images/988fb0dc960d95c7667ba992583dc9a57414fad858a24668f289842fdcb5e620.png" />
<img alt="../_images/4a1a28a069c36364b02ccd3fb21969b0b3185d96a1fad5b3e19b74da59db8311.png" src="../_images/4a1a28a069c36364b02ccd3fb21969b0b3185d96a1fad5b3e19b74da59db8311.png" />
<img alt="../_images/b3fced770fe7c2f27d9344eb3583e26e4b1a1dc7f0658af154a31575bd772725.png" src="../_images/b3fced770fe7c2f27d9344eb3583e26e4b1a1dc7f0658af154a31575bd772725.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">map()</span></code>函数是一定要返回列表的，但<code class="docutils literal notranslate"><span class="pre">walk()</span></code>看上去函数没有返回值，实际上它返回的就是它的输入，只是用户不可见而已。<img alt="image.png" src="../_images/walk.png" />
这样的设计很有用，尤其在管道操作中，我们可以统计中，用<code class="docutils literal notranslate"><span class="pre">walk()</span></code>保存中间计算的结果或者生成图片，然后若无其事地继续管道（因为<code class="docutils literal notranslate"><span class="pre">walk()</span></code>返回值，就是输入<code class="docutils literal notranslate"><span class="pre">walk</span></code>的值），保持计算的连贯。</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A03-%E8%AF%AD%E6%B3%95%E5%87%BD%E6%95%B03-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-stringr%E5%8C%85.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">语法函数3-正则表达式-stringr包</p>
      </div>
    </a>
    <a class="right-next"
       href="R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A05-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-ggplot%E5%85%A5%E9%97%A8.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">数据可视化-ggplot入门</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">因子型变量_数据框_函数式编程purrr包</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">什么是因子</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">创建因子</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">调整因子顺序</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">应用</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-reorder"><code class="docutils literal notranslate"> <span class="pre">fct_reorder()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-rev"><code class="docutils literal notranslate"><span class="pre">fct_rev()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fct-relevel"><code class="docutils literal notranslate"><span class="pre">fct_relevel()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">可视化中应用</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">简单数据框</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tidyverse"><code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> 家族</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tibble">人性化的<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tibble-data-frame">tibble 与 data.frame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><code class="docutils literal notranslate"><span class="pre">tibble</span></code>数据操作</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">1 创建<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2 转换成<code class="docutils literal notranslate"><span class="pre">tibble</span></code>类型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">3 <code class="docutils literal notranslate"><span class="pre">tibble</span></code>简单操作</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lst">4 有用的函数<code class="docutils literal notranslate"><span class="pre">lst</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enframe">5 有用的函数<code class="docutils literal notranslate"><span class="pre">enframe</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deframe">6 有用的函数<code class="docutils literal notranslate"><span class="pre">deframe</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">7 读取文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">关于行名</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">修复列名</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-columns"><code class="docutils literal notranslate"><span class="pre">List-columns</span></code>(列表列)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nested-tibble"><code class="docutils literal notranslate"><span class="pre">nested</span> <span class="pre">tibble</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating">1 <code class="docutils literal notranslate"><span class="pre">creating</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">1 creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tidyr-summarise-list"><code class="docutils literal notranslate"><span class="pre">tidyr::summarise(list())</span></code>创建</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">1 creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dplyr-mutate"><code class="docutils literal notranslate"><span class="pre">dplyr::mutate()</span></code>创建</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unnesting">2 Unnesting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulating">Manipulating</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">函数式编程1——<code class="docutils literal notranslate"><span class="pre">purrr</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">向量化运算</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">列表</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vs">列表 vs 向量</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19"><code class="docutils literal notranslate"><span class="pre">purrr</span></code>包</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map">1 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">2 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数家族</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">3 <code class="docutils literal notranslate"><span class="pre">map</span></code>函数小结</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">4 额外参数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">5 匿名函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dplyrmap">在<code class="docutils literal notranslate"><span class="pre">dplyr</span></code>函数中的运用<code class="docutils literal notranslate"><span class="pre">map</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">1 在<code class="docutils literal notranslate"><span class="pre">Tibble</span></code>中</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#col-column">2 在<code class="docutils literal notranslate"><span class="pre">col-column</span></code>中</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">函数式编程2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map2"><code class="docutils literal notranslate"><span class="pre">map2()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pmap"><code class="docutils literal notranslate"><span class="pre">pmap()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">1 用在<code class="docutils literal notranslate"><span class="pre">tibble</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">2 匿名函数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">3 命名函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">其他<code class="docutils literal notranslate"><span class="pre">purrr</span></code>函数</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map-functions-that-output-tibbles">1 Map functions that output tibbles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#walk-and-friends">2 Walk and friends</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Lulu Shi
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>